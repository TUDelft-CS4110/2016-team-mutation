<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>TextField.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">libGDX Core</a> &gt; <a href="index.html" class="el_package">com.badlogic.gdx.scenes.scene2d.ui</a> &gt; <span class="el_source">TextField.java</span></div><h1>TextField.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright 2011 See AUTHORS file.
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

package com.badlogic.gdx.scenes.scene2d.ui;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.Input;
import com.badlogic.gdx.Input.Keys;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.g2d.Batch;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.BitmapFont.BitmapFontData;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.GlyphLayout.GlyphRun;
import com.badlogic.gdx.math.MathUtils;
import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.scenes.scene2d.Actor;
import com.badlogic.gdx.scenes.scene2d.Group;
import com.badlogic.gdx.scenes.scene2d.InputEvent;
import com.badlogic.gdx.scenes.scene2d.InputListener;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.scenes.scene2d.utils.ChangeListener.ChangeEvent;
import com.badlogic.gdx.scenes.scene2d.utils.ClickListener;
import com.badlogic.gdx.scenes.scene2d.utils.Disableable;
import com.badlogic.gdx.scenes.scene2d.utils.Drawable;
import com.badlogic.gdx.scenes.scene2d.utils.UIUtils;
import com.badlogic.gdx.utils.Align;
import com.badlogic.gdx.utils.Array;
import com.badlogic.gdx.utils.Clipboard;
import com.badlogic.gdx.utils.FloatArray;
import com.badlogic.gdx.utils.Pools;
import com.badlogic.gdx.utils.TimeUtils;
import com.badlogic.gdx.utils.Timer;
import com.badlogic.gdx.utils.Timer.Task;

/** A single-line text input field.
 * &lt;p&gt;
 * The preferred height of a text field is the height of the {@link TextFieldStyle#font} and {@link TextFieldStyle#background}.
 * The preferred width of a text field is 150, a relatively arbitrary size.
 * &lt;p&gt;
 * The text field will copy the currently selected text when ctrl+c is pressed, and paste any text in the clipboard when ctrl+v is
 * pressed. Clipboard functionality is provided via the {@link Clipboard} interface. Currently there are two standard
 * implementations, one for the desktop and one for Android. The Android clipboard is a stub, as copy &amp; pasting on Android is not
 * supported yet.
 * &lt;p&gt;
 * The text field allows you to specify an {@link OnscreenKeyboard} for displaying a softkeyboard and piping all key events
 * generated by the keyboard to the text field. There are two standard implementations, one for the desktop and one for Android.
 * The desktop keyboard is a stub, as a softkeyboard is not needed on the desktop. The Android {@link OnscreenKeyboard}
 * implementation will bring up the default IME.
 * @author mzechner
 * @author Nathan Sweet */
public class TextField extends Widget implements Disableable {
	static private final char BACKSPACE = 8;
	static protected final char ENTER_DESKTOP = '\r';
	static protected final char ENTER_ANDROID = '\n';
	static private final char TAB = '\t';
	static private final char DELETE = 127;
	static private final char BULLET = 149;

<span class="nc" id="L73">	static private final Vector2 tmp1 = new Vector2();</span>
<span class="nc" id="L74">	static private final Vector2 tmp2 = new Vector2();</span>
<span class="nc" id="L75">	static private final Vector2 tmp3 = new Vector2();</span>

<span class="nc" id="L77">	static public float keyRepeatInitialTime = 0.4f;</span>
<span class="nc" id="L78">	static public float keyRepeatTime = 0.1f;</span>

	protected String text;
	protected int cursor, selectionStart;
	protected boolean hasSelection;
	protected boolean writeEnters;
<span class="nc" id="L84">	protected final GlyphLayout layout = new GlyphLayout();</span>
<span class="nc" id="L85">	protected final FloatArray glyphPositions = new FloatArray();</span>

	TextFieldStyle style;
	private String messageText;
	protected CharSequence displayText;
	Clipboard clipboard;
	InputListener inputListener;
	TextFieldListener listener;
	TextFieldFilter filter;
<span class="nc" id="L94">	OnscreenKeyboard keyboard = new DefaultOnscreenKeyboard();</span>
<span class="nc" id="L95">	boolean focusTraversal = true, onlyFontChars = true, disabled;</span>
<span class="nc" id="L96">	private int textHAlign = Align.left;</span>
	private float selectionX, selectionWidth;

	boolean passwordMode;
	private StringBuilder passwordBuffer;
<span class="nc" id="L101">	private char passwordCharacter = BULLET;</span>

	protected float fontOffset, textHeight, textOffset;
	float renderOffset;
	private int visibleTextStart, visibleTextEnd;
<span class="nc" id="L106">	private int maxLength = 0;</span>

<span class="nc" id="L108">	private float blinkTime = 0.32f;</span>
<span class="nc" id="L109">	boolean cursorOn = true;</span>
	long lastBlink;

<span class="nc" id="L112">	KeyRepeatTask keyRepeatTask = new KeyRepeatTask();</span>
	boolean programmaticChangeEvents;

	public TextField (String text, Skin skin) {
<span class="nc" id="L116">		this(text, skin.get(TextFieldStyle.class));</span>
<span class="nc" id="L117">	}</span>

	public TextField (String text, Skin skin, String styleName) {
<span class="nc" id="L120">		this(text, skin.get(styleName, TextFieldStyle.class));</span>
<span class="nc" id="L121">	}</span>

<span class="nc" id="L123">	public TextField (String text, TextFieldStyle style) {</span>
<span class="nc" id="L124">		setStyle(style);</span>
<span class="nc" id="L125">		clipboard = Gdx.app.getClipboard();</span>
<span class="nc" id="L126">		initialize();</span>
<span class="nc" id="L127">		setText(text);</span>
<span class="nc" id="L128">		setSize(getPrefWidth(), getPrefHeight());</span>
<span class="nc" id="L129">	}</span>

	protected void initialize () {
<span class="nc" id="L132">		addListener(inputListener = createInputListener());</span>
<span class="nc" id="L133">	}</span>

	protected InputListener createInputListener () {
<span class="nc" id="L136">		return new TextFieldClickListener();</span>
	}

	protected int letterUnderCursor (float x) {
<span class="nc" id="L140">		x -= textOffset + fontOffset - style.font.getData().cursorX - glyphPositions.get(visibleTextStart);</span>
<span class="nc" id="L141">		int n = this.glyphPositions.size;</span>
<span class="nc" id="L142">		float[] glyphPositions = this.glyphPositions.items;</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		for (int i = 1; i &lt; n; i++) {</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">			if (glyphPositions[i] &gt; x) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">				if (glyphPositions[i] - x &lt;= x - glyphPositions[i - 1]) return i;</span>
<span class="nc" id="L146">				return i - 1;</span>
			}
		}
<span class="nc" id="L149">		return n - 1;</span>
	}

	protected boolean isWordCharacter (char c) {
<span class="nc bnc" id="L153" title="All 12 branches missed.">		return (c &gt;= 'A' &amp;&amp; c &lt;= 'Z') || (c &gt;= 'a' &amp;&amp; c &lt;= 'z') || (c &gt;= '0' &amp;&amp; c &lt;= '9');</span>
	}

	protected int[] wordUnderCursor (int at) {
<span class="nc" id="L157">		String text = this.text;</span>
<span class="nc" id="L158">		int start = at, right = text.length(), left = 0, index = start;</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">		for (; index &lt; right; index++) {</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">			if (!isWordCharacter(text.charAt(index))) {</span>
<span class="nc" id="L161">				right = index;</span>
<span class="nc" id="L162">				break;</span>
			}
		}
<span class="nc bnc" id="L165" title="All 2 branches missed.">		for (index = start - 1; index &gt; -1; index--) {</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">			if (!isWordCharacter(text.charAt(index))) {</span>
<span class="nc" id="L167">				left = index + 1;</span>
<span class="nc" id="L168">				break;</span>
			}
		}
<span class="nc" id="L171">		return new int[] {left, right};</span>
	}

	int[] wordUnderCursor (float x) {
<span class="nc" id="L175">		return wordUnderCursor(letterUnderCursor(x));</span>
	}

	boolean withinMaxLength (int size) {
<span class="nc bnc" id="L179" title="All 4 branches missed.">		return maxLength &lt;= 0 || size &lt; maxLength;</span>
	}

	public void setMaxLength (int maxLength) {
<span class="nc" id="L183">		this.maxLength = maxLength;</span>
<span class="nc" id="L184">	}</span>

	public int getMaxLength () {
<span class="nc" id="L187">		return this.maxLength;</span>
	}

	/** When false, text set by {@link #setText(String)} may contain characters not in the font, a space will be displayed instead.
	 * When true (the default), characters not in the font are stripped by setText. Characters not in the font are always stripped
	 * when typed or pasted. */
	public void setOnlyFontChars (boolean onlyFontChars) {
<span class="nc" id="L194">		this.onlyFontChars = onlyFontChars;</span>
<span class="nc" id="L195">	}</span>

	public void setStyle (TextFieldStyle style) {
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (style == null) throw new IllegalArgumentException(&quot;style cannot be null.&quot;);</span>
<span class="nc" id="L199">		this.style = style;</span>
<span class="nc" id="L200">		textHeight = style.font.getCapHeight() - style.font.getDescent() * 2;</span>
<span class="nc" id="L201">		invalidateHierarchy();</span>
<span class="nc" id="L202">	}</span>

	/** Returns the text field's style. Modifying the returned style may not have an effect until {@link #setStyle(TextFieldStyle)}
	 * is called. */
	public TextFieldStyle getStyle () {
<span class="nc" id="L207">		return style;</span>
	}

	protected void calculateOffsets () {
<span class="nc" id="L211">		float visibleWidth = getWidth();</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">		if (style.background != null) visibleWidth -= style.background.getLeftWidth() + style.background.getRightWidth();</span>

<span class="nc" id="L214">		int glyphCount = glyphPositions.size;</span>
<span class="nc" id="L215">		float[] glyphPositions = this.glyphPositions.items;</span>

		// Check if the cursor has gone out the left or right side of the visible area and adjust renderoffset.
<span class="nc" id="L218">		float distance = glyphPositions[Math.max(0, cursor - 1)] + renderOffset;</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">		if (distance &lt;= 0)</span>
<span class="nc" id="L220">			renderOffset -= distance;</span>
		else {
<span class="nc" id="L222">			int index = Math.min(glyphCount - 1, cursor + 1);</span>
<span class="nc" id="L223">			float minX = glyphPositions[index] - visibleWidth;</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">			if (-renderOffset &lt; minX) {</span>
<span class="nc" id="L225">				renderOffset = -minX;</span>
			}
		}

		// calculate first visible char based on render offset
<span class="nc" id="L230">		visibleTextStart = 0;</span>
<span class="nc" id="L231">		float startX = 0;</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">		for (int i = 0; i &lt; glyphCount; i++) {</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">			if (glyphPositions[i] &gt;= -renderOffset) {</span>
<span class="nc" id="L234">				visibleTextStart = Math.max(0, i);</span>
<span class="nc" id="L235">				startX = glyphPositions[i];</span>
<span class="nc" id="L236">				break;</span>
			}
		}

		// calculate last visible char based on visible width and render offset
<span class="nc" id="L241">		int length = displayText.length();</span>
<span class="nc" id="L242">		visibleTextEnd = Math.min(length, cursor + 1);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">		for (; visibleTextEnd &lt;= length; visibleTextEnd++)</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">			if (glyphPositions[visibleTextEnd] &gt; startX + visibleWidth) break;</span>
<span class="nc" id="L245">		visibleTextEnd = Math.max(0, visibleTextEnd - 1);</span>

<span class="nc bnc" id="L247" title="All 2 branches missed.">		if ((textHAlign &amp; Align.left) == 0) {</span>
<span class="nc" id="L248">			textOffset = visibleWidth - (glyphPositions[visibleTextEnd] - startX);</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">			if ((textHAlign &amp; Align.center) != 0) textOffset = Math.round(textOffset * 0.5f);</span>
		} else
<span class="nc" id="L251">			textOffset = startX + renderOffset;</span>

		// calculate selection x position and width
<span class="nc bnc" id="L254" title="All 2 branches missed.">		if (hasSelection) {</span>
<span class="nc" id="L255">			int minIndex = Math.min(cursor, selectionStart);</span>
<span class="nc" id="L256">			int maxIndex = Math.max(cursor, selectionStart);</span>
<span class="nc" id="L257">			float minX = Math.max(glyphPositions[minIndex], -renderOffset);</span>
<span class="nc" id="L258">			float maxX = Math.min(glyphPositions[maxIndex], visibleWidth - renderOffset);</span>
<span class="nc" id="L259">			selectionX = minX;</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">			if (renderOffset == 0) selectionX += textOffset;</span>
<span class="nc" id="L261">			selectionWidth = maxX - minX - style.font.getData().cursorX;</span>
		}
<span class="nc" id="L263">	}</span>

	@Override
	public void draw (Batch batch, float parentAlpha) {
<span class="nc" id="L267">		Stage stage = getStage();</span>
<span class="nc bnc" id="L268" title="All 4 branches missed.">		boolean focused = stage != null &amp;&amp; stage.getKeyboardFocus() == this;</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">		if (!focused) keyRepeatTask.cancel();</span>

<span class="nc" id="L271">		final BitmapFont font = style.font;</span>
<span class="nc bnc" id="L272" title="All 8 branches missed.">		final Color fontColor = (disabled &amp;&amp; style.disabledFontColor != null) ? style.disabledFontColor</span>
			: ((focused &amp;&amp; style.focusedFontColor != null) ? style.focusedFontColor : style.fontColor);
<span class="nc" id="L274">		final Drawable selection = style.selection;</span>
<span class="nc" id="L275">		final Drawable cursorPatch = style.cursor;</span>
<span class="nc bnc" id="L276" title="All 8 branches missed.">		final Drawable background = (disabled &amp;&amp; style.disabledBackground != null) ? style.disabledBackground</span>
			: ((focused &amp;&amp; style.focusedBackground != null) ? style.focusedBackground : style.background);

<span class="nc" id="L279">		Color color = getColor();</span>
<span class="nc" id="L280">		float x = getX();</span>
<span class="nc" id="L281">		float y = getY();</span>
<span class="nc" id="L282">		float width = getWidth();</span>
<span class="nc" id="L283">		float height = getHeight();</span>

<span class="nc" id="L285">		batch.setColor(color.r, color.g, color.b, color.a * parentAlpha);</span>
<span class="nc" id="L286">		float bgLeftWidth = 0, bgRightWidth = 0;</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">		if (background != null) {</span>
<span class="nc" id="L288">			background.draw(batch, x, y, width, height);</span>
<span class="nc" id="L289">			bgLeftWidth = background.getLeftWidth();</span>
<span class="nc" id="L290">			bgRightWidth = background.getRightWidth();</span>
		}

<span class="nc" id="L293">		float textY = getTextY(font, background);</span>
<span class="nc" id="L294">		calculateOffsets();</span>

<span class="nc bnc" id="L296" title="All 6 branches missed.">		if (focused &amp;&amp; hasSelection &amp;&amp; selection != null) {</span>
<span class="nc" id="L297">			drawSelection(selection, batch, font, x + bgLeftWidth, y + textY);</span>
		}

<span class="nc bnc" id="L300" title="All 2 branches missed.">		float yOffset = font.isFlipped() ? -textHeight : 0;</span>
<span class="nc bnc" id="L301" title="All 2 branches missed.">		if (displayText.length() == 0) {</span>
<span class="nc bnc" id="L302" title="All 4 branches missed.">			if (!focused &amp;&amp; messageText != null) {</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">				if (style.messageFontColor != null) {</span>
<span class="nc" id="L304">					font.setColor(style.messageFontColor.r, style.messageFontColor.g, style.messageFontColor.b,</span>
						style.messageFontColor.a * color.a * parentAlpha);
				} else
<span class="nc" id="L307">					font.setColor(0.7f, 0.7f, 0.7f, color.a * parentAlpha);</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">				BitmapFont messageFont = style.messageFont != null ? style.messageFont : font;</span>
<span class="nc" id="L309">				messageFont.draw(batch, messageText, x + bgLeftWidth, y + textY + yOffset, 0, messageText.length(),</span>
					width - bgLeftWidth - bgRightWidth, textHAlign, false, &quot;...&quot;);
<span class="nc" id="L311">			}</span>
		} else {
<span class="nc" id="L313">			font.setColor(fontColor.r, fontColor.g, fontColor.b, fontColor.a * color.a * parentAlpha);</span>
<span class="nc" id="L314">			drawText(batch, font, x + bgLeftWidth, y + textY + yOffset);</span>
		}
<span class="nc bnc" id="L316" title="All 4 branches missed.">		if (focused &amp;&amp; !disabled) {</span>
<span class="nc" id="L317">			blink();</span>
<span class="nc bnc" id="L318" title="All 4 branches missed.">			if (cursorOn &amp;&amp; cursorPatch != null) {</span>
<span class="nc" id="L319">				drawCursor(cursorPatch, batch, font, x + bgLeftWidth, y + textY);</span>
			}
		}
<span class="nc" id="L322">	}</span>

	protected float getTextY (BitmapFont font, Drawable background) {
<span class="nc" id="L325">		float height = getHeight();</span>
<span class="nc" id="L326">		float textY = textHeight / 2 + font.getDescent();</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">		if (background != null) {</span>
<span class="nc" id="L328">			float bottom = background.getBottomHeight();</span>
<span class="nc" id="L329">			textY = textY + (height - background.getTopHeight() - bottom) / 2 + bottom;</span>
<span class="nc" id="L330">		} else {</span>
<span class="nc" id="L331">			textY = textY + height / 2;</span>
		}
<span class="nc bnc" id="L333" title="All 2 branches missed.">		if (font.usesIntegerPositions()) textY = (int)textY;</span>
<span class="nc" id="L334">		return textY;</span>
	}

	/** Draws selection rectangle **/
	protected void drawSelection (Drawable selection, Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L339">		selection.draw(batch, x + selectionX + renderOffset + fontOffset, y - textHeight - font.getDescent(), selectionWidth,</span>
			textHeight);
<span class="nc" id="L341">	}</span>

	protected void drawText (Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L344">		font.draw(batch, displayText, x + textOffset, y, visibleTextStart, visibleTextEnd, 0, Align.left, false);</span>
<span class="nc" id="L345">	}</span>

	protected void drawCursor (Drawable cursorPatch, Batch batch, BitmapFont font, float x, float y) {
<span class="nc" id="L348">		cursorPatch.draw(batch,</span>
			x + textOffset + glyphPositions.get(cursor) - glyphPositions.get(visibleTextStart) + fontOffset + font.getData().cursorX,
			y - textHeight - font.getDescent(), cursorPatch.getMinWidth(), textHeight);
<span class="nc" id="L351">	}</span>

	void updateDisplayText () {
<span class="nc" id="L354">		BitmapFont font = style.font;</span>
<span class="nc" id="L355">		BitmapFontData data = font.getData();</span>
<span class="nc" id="L356">		String text = this.text;</span>
<span class="nc" id="L357">		int textLength = text.length();</span>

<span class="nc" id="L359">		StringBuilder buffer = new StringBuilder();</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">		for (int i = 0; i &lt; textLength; i++) {</span>
<span class="nc" id="L361">			char c = text.charAt(i);</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">			buffer.append(data.hasGlyph(c) ? c : ' ');</span>
		}
<span class="nc" id="L364">		String newDisplayText = buffer.toString();</span>

<span class="nc bnc" id="L366" title="All 4 branches missed.">		if (passwordMode &amp;&amp; data.hasGlyph(passwordCharacter)) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">			if (passwordBuffer == null) passwordBuffer = new StringBuilder(newDisplayText.length());</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">			if (passwordBuffer.length() &gt; textLength)</span>
<span class="nc" id="L369">				passwordBuffer.setLength(textLength);</span>
			else {
<span class="nc bnc" id="L371" title="All 2 branches missed.">				for (int i = passwordBuffer.length(); i &lt; textLength; i++)</span>
<span class="nc" id="L372">					passwordBuffer.append(passwordCharacter);</span>
			}
<span class="nc" id="L374">			displayText = passwordBuffer;</span>
		} else
<span class="nc" id="L376">			displayText = newDisplayText;</span>

<span class="nc" id="L378">		layout.setText(font, displayText);</span>
<span class="nc" id="L379">		glyphPositions.clear();</span>
<span class="nc" id="L380">		float x = 0;</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">		if (layout.runs.size &gt; 0) {</span>
<span class="nc" id="L382">			GlyphRun run = layout.runs.first();</span>
<span class="nc" id="L383">			FloatArray xAdvances = run.xAdvances;</span>
<span class="nc" id="L384">			fontOffset = xAdvances.first();</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">			for (int i = 1, n = xAdvances.size; i &lt; n; i++) {</span>
<span class="nc" id="L386">				glyphPositions.add(x);</span>
<span class="nc" id="L387">				x += xAdvances.get(i);</span>
			}
<span class="nc" id="L389">		} else</span>
<span class="nc" id="L390">			fontOffset = 0;</span>
<span class="nc" id="L391">		glyphPositions.add(x);</span>

<span class="nc bnc" id="L393" title="All 2 branches missed.">		if (selectionStart &gt; newDisplayText.length()) selectionStart = textLength;</span>
<span class="nc" id="L394">	}</span>

	private void blink () {
<span class="nc bnc" id="L397" title="All 2 branches missed.">		if (!Gdx.graphics.isContinuousRendering()) {</span>
<span class="nc" id="L398">			cursorOn = true;</span>
<span class="nc" id="L399">			return;</span>
		}
<span class="nc" id="L401">		long time = TimeUtils.nanoTime();</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">		if ((time - lastBlink) / 1000000000.0f &gt; blinkTime) {</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">			cursorOn = !cursorOn;</span>
<span class="nc" id="L404">			lastBlink = time;</span>
		}
<span class="nc" id="L406">	}</span>

	/** Copies the contents of this TextField to the {@link Clipboard} implementation set on this TextField. */
	public void copy () {
<span class="nc bnc" id="L410" title="All 4 branches missed.">		if (hasSelection &amp;&amp; !passwordMode) {</span>
<span class="nc" id="L411">			clipboard.setContents(text.substring(Math.min(cursor, selectionStart), Math.max(cursor, selectionStart)));</span>
		}
<span class="nc" id="L413">	}</span>

	/** Copies the selected contents of this TextField to the {@link Clipboard} implementation set on this TextField, then removes
	 * it. */
	public void cut () {
<span class="nc" id="L418">		cut(programmaticChangeEvents);</span>
<span class="nc" id="L419">	}</span>

	void cut (boolean fireChangeEvent) {
<span class="nc bnc" id="L422" title="All 4 branches missed.">		if (hasSelection &amp;&amp; !passwordMode) {</span>
<span class="nc" id="L423">			copy();</span>
<span class="nc" id="L424">			cursor = delete(fireChangeEvent);</span>
<span class="nc" id="L425">			updateDisplayText();</span>
		}
<span class="nc" id="L427">	}</span>

	void paste (String content, boolean fireChangeEvent) {
<span class="nc bnc" id="L430" title="All 2 branches missed.">		if (content == null) return;</span>
<span class="nc" id="L431">		StringBuilder buffer = new StringBuilder();</span>
<span class="nc" id="L432">		int textLength = text.length();</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">		if (hasSelection) textLength -= Math.abs(cursor - selectionStart);</span>
<span class="nc" id="L434">		BitmapFontData data = style.font.getData();</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">		for (int i = 0, n = content.length(); i &lt; n; i++) {</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">			if (!withinMaxLength(textLength + buffer.length())) break;</span>
<span class="nc" id="L437">			char c = content.charAt(i);</span>
<span class="nc bnc" id="L438" title="All 6 branches missed.">			if (!(writeEnters &amp;&amp; (c == ENTER_ANDROID || c == ENTER_DESKTOP))) {</span>
<span class="nc bnc" id="L439" title="All 4 branches missed.">				if (onlyFontChars &amp;&amp; !data.hasGlyph(c)) continue;</span>
<span class="nc bnc" id="L440" title="All 4 branches missed.">				if (filter != null &amp;&amp; !filter.acceptChar(this, c)) continue;</span>
			}
<span class="nc" id="L442">			buffer.append(c);</span>
		}
<span class="nc" id="L444">		content = buffer.toString();</span>

<span class="nc bnc" id="L446" title="All 2 branches missed.">		if (hasSelection) cursor = delete(fireChangeEvent);</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">		if (fireChangeEvent)</span>
<span class="nc" id="L448">			changeText(text, insert(cursor, content, text));</span>
		else
<span class="nc" id="L450">			text = insert(cursor, content, text);</span>
<span class="nc" id="L451">		updateDisplayText();</span>
<span class="nc" id="L452">		cursor += content.length();</span>
<span class="nc" id="L453">	}</span>

	String insert (int position, CharSequence text, String to) {
<span class="nc bnc" id="L456" title="All 2 branches missed.">		if (to.length() == 0) return text.toString();</span>
<span class="nc" id="L457">		return to.substring(0, position) + text + to.substring(position, to.length());</span>
	}

	int delete (boolean fireChangeEvent) {
<span class="nc" id="L461">		int from = selectionStart;</span>
<span class="nc" id="L462">		int to = cursor;</span>
<span class="nc" id="L463">		int minIndex = Math.min(from, to);</span>
<span class="nc" id="L464">		int maxIndex = Math.max(from, to);</span>
<span class="nc bnc" id="L465" title="All 4 branches missed.">		String newText = (minIndex &gt; 0 ? text.substring(0, minIndex) : &quot;&quot;)</span>
			+ (maxIndex &lt; text.length() ? text.substring(maxIndex, text.length()) : &quot;&quot;);
<span class="nc bnc" id="L467" title="All 2 branches missed.">		if (fireChangeEvent)</span>
<span class="nc" id="L468">			changeText(text, newText);</span>
		else
<span class="nc" id="L470">			text = newText;</span>
<span class="nc" id="L471">		clearSelection();</span>
<span class="nc" id="L472">		return minIndex;</span>
	}

	/** Focuses the next TextField. If none is found, the keyboard is hidden. Does nothing if the text field is not in a stage.
	 * @param up If true, the TextField with the same or next smallest y coordinate is found, else the next highest. */
	public void next (boolean up) {
<span class="nc" id="L478">		Stage stage = getStage();</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">		if (stage == null) return;</span>
<span class="nc" id="L480">		getParent().localToStageCoordinates(tmp1.set(getX(), getY()));</span>
<span class="nc" id="L481">		TextField textField = findNextTextField(stage.getActors(), null, tmp2, tmp1, up);</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (textField == null) { // Try to wrap around.</span>
<span class="nc bnc" id="L483" title="All 2 branches missed.">			if (up)</span>
<span class="nc" id="L484">				tmp1.set(Float.MIN_VALUE, Float.MIN_VALUE);</span>
			else
<span class="nc" id="L486">				tmp1.set(Float.MAX_VALUE, Float.MAX_VALUE);</span>
<span class="nc" id="L487">			textField = findNextTextField(getStage().getActors(), null, tmp2, tmp1, up);</span>
		}
<span class="nc bnc" id="L489" title="All 2 branches missed.">		if (textField != null)</span>
<span class="nc" id="L490">			stage.setKeyboardFocus(textField);</span>
		else
<span class="nc" id="L492">			Gdx.input.setOnscreenKeyboardVisible(false);</span>
<span class="nc" id="L493">	}</span>

	private TextField findNextTextField (Array&lt;Actor&gt; actors, TextField best, Vector2 bestCoords, Vector2 currentCoords,
		boolean up) {
<span class="nc bnc" id="L497" title="All 2 branches missed.">		for (int i = 0, n = actors.size; i &lt; n; i++) {</span>
<span class="nc" id="L498">			Actor actor = actors.get(i);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">			if (actor == this) continue;</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">			if (actor instanceof TextField) {</span>
<span class="nc" id="L501">				TextField textField = (TextField)actor;</span>
<span class="nc bnc" id="L502" title="All 4 branches missed.">				if (textField.isDisabled() || !textField.focusTraversal) continue;</span>
<span class="nc" id="L503">				Vector2 actorCoords = actor.getParent().localToStageCoordinates(tmp3.set(actor.getX(), actor.getY()));</span>
<span class="nc bnc" id="L504" title="All 8 branches missed.">				if ((actorCoords.y &lt; currentCoords.y || (actorCoords.y == currentCoords.y &amp;&amp; actorCoords.x &gt; currentCoords.x)) ^ up) {</span>
<span class="nc bnc" id="L505" title="All 10 branches missed.">					if (best == null</span>
						|| (actorCoords.y &gt; bestCoords.y || (actorCoords.y == bestCoords.y &amp;&amp; actorCoords.x &lt; bestCoords.x)) ^ up) {
<span class="nc" id="L507">						best = (TextField)actor;</span>
<span class="nc" id="L508">						bestCoords.set(actorCoords);</span>
					}
				}
<span class="nc bnc" id="L511" title="All 2 branches missed.">			} else if (actor instanceof Group)</span>
<span class="nc" id="L512">				best = findNextTextField(((Group)actor).getChildren(), best, bestCoords, currentCoords, up);</span>
		}
<span class="nc" id="L514">		return best;</span>
	}

	public InputListener getDefaultInputListener () {
<span class="nc" id="L518">		return inputListener;</span>
	}

	/** @param listener May be null. */
	public void setTextFieldListener (TextFieldListener listener) {
<span class="nc" id="L523">		this.listener = listener;</span>
<span class="nc" id="L524">	}</span>

	/** @param filter May be null. */
	public void setTextFieldFilter (TextFieldFilter filter) {
<span class="nc" id="L528">		this.filter = filter;</span>
<span class="nc" id="L529">	}</span>

	public TextFieldFilter getTextFieldFilter () {
<span class="nc" id="L532">		return filter;</span>
	}

	/** If true (the default), tab/shift+tab will move to the next text field. */
	public void setFocusTraversal (boolean focusTraversal) {
<span class="nc" id="L537">		this.focusTraversal = focusTraversal;</span>
<span class="nc" id="L538">	}</span>

	/** @return May be null. */
	public String getMessageText () {
<span class="nc" id="L542">		return messageText;</span>
	}

	/** Sets the text that will be drawn in the text field if no text has been entered.
	 * @param messageText may be null. */
	public void setMessageText (String messageText) {
<span class="nc" id="L548">		this.messageText = messageText;</span>
<span class="nc" id="L549">	}</span>

	/** @param str If null, &quot;&quot; is used. */
	public void appendText (String str) {
<span class="nc bnc" id="L553" title="All 2 branches missed.">		if (str == null) str = &quot;&quot;;</span>

<span class="nc" id="L555">		clearSelection();</span>
<span class="nc" id="L556">		cursor = text.length();</span>
<span class="nc" id="L557">		paste(str, programmaticChangeEvents);</span>
<span class="nc" id="L558">	}</span>

	/** @param str If null, &quot;&quot; is used. */
	public void setText (String str) {
<span class="nc bnc" id="L562" title="All 2 branches missed.">		if (str == null) str = &quot;&quot;;</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">		if (str.equals(text)) return;</span>

<span class="nc" id="L565">		clearSelection();</span>
<span class="nc" id="L566">		String oldText = text;</span>
<span class="nc" id="L567">		text = &quot;&quot;;</span>
<span class="nc" id="L568">		paste(str, false);</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">		if (programmaticChangeEvents) changeText(oldText, text);</span>
<span class="nc" id="L570">		cursor = 0;</span>
<span class="nc" id="L571">	}</span>

	/** @return Never null, might be an empty string. */
	public String getText () {
<span class="nc" id="L575">		return text;</span>
	}

	/** @param oldText May be null.
	 * @return True if the text was changed. */
	boolean changeText (String oldText, String newText) {
<span class="nc bnc" id="L581" title="All 2 branches missed.">		if (newText.equals(oldText)) return false;</span>
<span class="nc" id="L582">		text = newText;</span>
<span class="nc" id="L583">		ChangeEvent changeEvent = Pools.obtain(ChangeEvent.class);</span>
<span class="nc" id="L584">		boolean cancelled = fire(changeEvent);</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">		text = cancelled ? oldText : newText;</span>
<span class="nc" id="L586">		Pools.free(changeEvent);</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">		return !cancelled;</span>
	}

	/** If false, methods that change the text will not fire {@link ChangeEvent}, the event will be fired only when user changes
	 * the text. */
	public void setProgrammaticChangeEvents (boolean programmaticChangeEvents) {
<span class="nc" id="L593">		this.programmaticChangeEvents = programmaticChangeEvents;</span>
<span class="nc" id="L594">	}</span>

	public int getSelectionStart () {
<span class="nc" id="L597">		return selectionStart;</span>
	}

	public String getSelection () {
<span class="nc bnc" id="L601" title="All 2 branches missed.">		return hasSelection ? text.substring(Math.min(selectionStart, cursor), Math.max(selectionStart, cursor)) : &quot;&quot;;</span>
	}

	/** Sets the selected text. */
	public void setSelection (int selectionStart, int selectionEnd) {
<span class="nc bnc" id="L606" title="All 2 branches missed.">		if (selectionStart &lt; 0) throw new IllegalArgumentException(&quot;selectionStart must be &gt;= 0&quot;);</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">		if (selectionEnd &lt; 0) throw new IllegalArgumentException(&quot;selectionEnd must be &gt;= 0&quot;);</span>
<span class="nc" id="L608">		selectionStart = Math.min(text.length(), selectionStart);</span>
<span class="nc" id="L609">		selectionEnd = Math.min(text.length(), selectionEnd);</span>
<span class="nc bnc" id="L610" title="All 2 branches missed.">		if (selectionEnd == selectionStart) {</span>
<span class="nc" id="L611">			clearSelection();</span>
<span class="nc" id="L612">			return;</span>
		}
<span class="nc bnc" id="L614" title="All 2 branches missed.">		if (selectionEnd &lt; selectionStart) {</span>
<span class="nc" id="L615">			int temp = selectionEnd;</span>
<span class="nc" id="L616">			selectionEnd = selectionStart;</span>
<span class="nc" id="L617">			selectionStart = temp;</span>
		}

<span class="nc" id="L620">		hasSelection = true;</span>
<span class="nc" id="L621">		this.selectionStart = selectionStart;</span>
<span class="nc" id="L622">		cursor = selectionEnd;</span>
<span class="nc" id="L623">	}</span>

	public void selectAll () {
<span class="nc" id="L626">		setSelection(0, text.length());</span>
<span class="nc" id="L627">	}</span>

	public void clearSelection () {
<span class="nc" id="L630">		hasSelection = false;</span>
<span class="nc" id="L631">	}</span>

	/** Sets the cursor position and clears any selection. */
	public void setCursorPosition (int cursorPosition) {
<span class="nc bnc" id="L635" title="All 2 branches missed.">		if (cursorPosition &lt; 0) throw new IllegalArgumentException(&quot;cursorPosition must be &gt;= 0&quot;);</span>
<span class="nc" id="L636">		clearSelection();</span>
<span class="nc" id="L637">		cursor = Math.min(cursorPosition, text.length());</span>
<span class="nc" id="L638">	}</span>

	public int getCursorPosition () {
<span class="nc" id="L641">		return cursor;</span>
	}

	/** Default is an instance of {@link DefaultOnscreenKeyboard}. */
	public OnscreenKeyboard getOnscreenKeyboard () {
<span class="nc" id="L646">		return keyboard;</span>
	}

	public void setOnscreenKeyboard (OnscreenKeyboard keyboard) {
<span class="nc" id="L650">		this.keyboard = keyboard;</span>
<span class="nc" id="L651">	}</span>

	public void setClipboard (Clipboard clipboard) {
<span class="nc" id="L654">		this.clipboard = clipboard;</span>
<span class="nc" id="L655">	}</span>

	public float getPrefWidth () {
<span class="nc" id="L658">		return 150;</span>
	}

	public float getPrefHeight () {
<span class="nc" id="L662">		float prefHeight = textHeight;</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">		if (style.background != null) {</span>
<span class="nc" id="L664">			prefHeight = Math.max(prefHeight + style.background.getBottomHeight() + style.background.getTopHeight(),</span>
				style.background.getMinHeight());
		}
<span class="nc" id="L667">		return prefHeight;</span>
	}

	/** Sets text horizontal alignment (left, center or right).
	 * @see Align */
	public void setAlignment (int alignment) {
<span class="nc" id="L673">		this.textHAlign = alignment;</span>
<span class="nc" id="L674">	}</span>

	/** If true, the text in this text field will be shown as bullet characters.
	 * @see #setPasswordCharacter(char) */
	public void setPasswordMode (boolean passwordMode) {
<span class="nc" id="L679">		this.passwordMode = passwordMode;</span>
<span class="nc" id="L680">		updateDisplayText();</span>
<span class="nc" id="L681">	}</span>

	public boolean isPasswordMode () {
<span class="nc" id="L684">		return passwordMode;</span>
	}

	/** Sets the password character for the text field. The character must be present in the {@link BitmapFont}. Default is 149
	 * (bullet). */
	public void setPasswordCharacter (char passwordCharacter) {
<span class="nc" id="L690">		this.passwordCharacter = passwordCharacter;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">		if (passwordMode) updateDisplayText();</span>
<span class="nc" id="L692">	}</span>

	public void setBlinkTime (float blinkTime) {
<span class="nc" id="L695">		this.blinkTime = blinkTime;</span>
<span class="nc" id="L696">	}</span>

	public void setDisabled (boolean disabled) {
<span class="nc" id="L699">		this.disabled = disabled;</span>
<span class="nc" id="L700">	}</span>

	public boolean isDisabled () {
<span class="nc" id="L703">		return disabled;</span>
	}

	protected void moveCursor (boolean forward, boolean jump) {
<span class="nc bnc" id="L707" title="All 2 branches missed.">		int limit = forward ? text.length() : 0;</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">		int charOffset = forward ? 0 : -1;</span>
<span class="nc bnc" id="L709" title="All 8 branches missed.">		while ((forward ? ++cursor &lt; limit : --cursor &gt; limit) &amp;&amp; jump) {</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">			if (!continueCursor(cursor, charOffset)) break;</span>
		}
<span class="nc" id="L712">	}</span>

	protected boolean continueCursor (int index, int offset) {
<span class="nc" id="L715">		char c = text.charAt(index + offset);</span>
<span class="nc" id="L716">		return isWordCharacter(c);</span>
	}

<span class="nc" id="L719">	class KeyRepeatTask extends Task {</span>
		int keycode;

		public void run () {
<span class="nc" id="L723">			inputListener.keyDown(null, keycode);</span>
<span class="nc" id="L724">		}</span>
	}

	/** Interface for listening to typed characters.
	 * @author mzechner */
	static public interface TextFieldListener {
		public void keyTyped (TextField textField, char c);
	}

	/** Interface for filtering characters entered into the text field.
	 * @author mzechner */
	static public interface TextFieldFilter {
		public boolean acceptChar (TextField textField, char c);

<span class="nc" id="L738">		static public class DigitsOnlyFilter implements TextFieldFilter {</span>
			@Override
			public boolean acceptChar (TextField textField, char c) {
<span class="nc" id="L741">				return Character.isDigit(c);</span>
			}

		}
	}

	/** An interface for onscreen keyboards. Can invoke the default keyboard or render your own keyboard!
	 * @author mzechner */
	static public interface OnscreenKeyboard {
		public void show (boolean visible);
	}

	/** The default {@link OnscreenKeyboard} used by all {@link TextField} instances. Just uses
	 * {@link Input#setOnscreenKeyboardVisible(boolean)} as appropriate. Might overlap your actual rendering, so use with care!
	 * @author mzechner */
<span class="nc" id="L756">	static public class DefaultOnscreenKeyboard implements OnscreenKeyboard {</span>
		@Override
		public void show (boolean visible) {
<span class="nc" id="L759">			Gdx.input.setOnscreenKeyboardVisible(visible);</span>
<span class="nc" id="L760">		}</span>
	}

	/** Basic input listener for the text field */
<span class="nc" id="L764">	public class TextFieldClickListener extends ClickListener {</span>
		public void clicked (InputEvent event, float x, float y) {
<span class="nc" id="L766">			int count = getTapCount() % 4;</span>
<span class="nc bnc" id="L767" title="All 2 branches missed.">			if (count == 0) clearSelection();</span>
<span class="nc bnc" id="L768" title="All 2 branches missed.">			if (count == 2) {</span>
<span class="nc" id="L769">				int[] array = wordUnderCursor(x);</span>
<span class="nc" id="L770">				setSelection(array[0], array[1]);</span>
			}
<span class="nc bnc" id="L772" title="All 2 branches missed.">			if (count == 3) selectAll();</span>
<span class="nc" id="L773">		}</span>

		public boolean touchDown (InputEvent event, float x, float y, int pointer, int button) {
<span class="nc bnc" id="L776" title="All 2 branches missed.">			if (!super.touchDown(event, x, y, pointer, button)) return false;</span>
<span class="nc bnc" id="L777" title="All 4 branches missed.">			if (pointer == 0 &amp;&amp; button != 0) return false;</span>
<span class="nc bnc" id="L778" title="All 2 branches missed.">			if (disabled) return true;</span>
<span class="nc" id="L779">			setCursorPosition(x, y);</span>
<span class="nc" id="L780">			selectionStart = cursor;</span>
<span class="nc" id="L781">			Stage stage = getStage();</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">			if (stage != null) stage.setKeyboardFocus(TextField.this);</span>
<span class="nc" id="L783">			keyboard.show(true);</span>
<span class="nc" id="L784">			hasSelection = true;</span>
<span class="nc" id="L785">			return true;</span>
		}

		public void touchDragged (InputEvent event, float x, float y, int pointer) {
<span class="nc" id="L789">			super.touchDragged(event, x, y, pointer);</span>
<span class="nc" id="L790">			setCursorPosition(x, y);</span>
<span class="nc" id="L791">		}</span>

		public void touchUp (InputEvent event, float x, float y, int pointer, int button) {
<span class="nc bnc" id="L794" title="All 2 branches missed.">			if (selectionStart == cursor) hasSelection = false;</span>
<span class="nc" id="L795">			super.touchUp(event, x, y, pointer, button);</span>
<span class="nc" id="L796">		}</span>

		protected void setCursorPosition (float x, float y) {
<span class="nc" id="L799">			lastBlink = 0;</span>
<span class="nc" id="L800">			cursorOn = false;</span>
<span class="nc" id="L801">			cursor = letterUnderCursor(x);</span>
<span class="nc" id="L802">		}</span>

		protected void goHome (boolean jump) {
<span class="nc" id="L805">			cursor = 0;</span>
<span class="nc" id="L806">		}</span>

		protected void goEnd (boolean jump) {
<span class="nc" id="L809">			cursor = text.length();</span>
<span class="nc" id="L810">		}</span>

		public boolean keyDown (InputEvent event, int keycode) {
<span class="nc bnc" id="L813" title="All 2 branches missed.">			if (disabled) return false;</span>

<span class="nc" id="L815">			lastBlink = 0;</span>
<span class="nc" id="L816">			cursorOn = false;</span>

<span class="nc" id="L818">			Stage stage = getStage();</span>
<span class="nc bnc" id="L819" title="All 4 branches missed.">			if (stage == null || stage.getKeyboardFocus() != TextField.this) return false;</span>

<span class="nc" id="L821">			boolean repeat = false;</span>
<span class="nc" id="L822">			boolean ctrl = UIUtils.ctrl();</span>
<span class="nc bnc" id="L823" title="All 4 branches missed.">			boolean jump = ctrl &amp;&amp; !passwordMode;</span>

<span class="nc bnc" id="L825" title="All 2 branches missed.">			if (ctrl) {</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">				if (keycode == Keys.V) {</span>
<span class="nc" id="L827">					paste(clipboard.getContents(), true);</span>
<span class="nc" id="L828">					repeat = true;</span>
				}
<span class="nc bnc" id="L830" title="All 4 branches missed.">				if (keycode == Keys.C || keycode == Keys.INSERT) {</span>
<span class="nc" id="L831">					copy();</span>
<span class="nc" id="L832">					return true;</span>
				}
<span class="nc bnc" id="L834" title="All 2 branches missed.">				if (keycode == Keys.X) {</span>
<span class="nc" id="L835">					cut(true);</span>
<span class="nc" id="L836">					return true;</span>
				}
<span class="nc bnc" id="L838" title="All 2 branches missed.">				if (keycode == Keys.A) {</span>
<span class="nc" id="L839">					selectAll();</span>
<span class="nc" id="L840">					return true;</span>
				}
			}

<span class="nc bnc" id="L844" title="All 2 branches missed.">			if (UIUtils.shift()) {</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">				if (keycode == Keys.INSERT) paste(clipboard.getContents(), true);</span>
<span class="nc bnc" id="L846" title="All 2 branches missed.">				if (keycode == Keys.FORWARD_DEL) cut(true);</span>
				selection:
				{
<span class="nc" id="L849">					int temp = cursor;</span>
					keys:
					{
<span class="nc bnc" id="L852" title="All 2 branches missed.">						if (keycode == Keys.LEFT) {</span>
<span class="nc" id="L853">							moveCursor(false, jump);</span>
<span class="nc" id="L854">							repeat = true;</span>
<span class="nc" id="L855">							break keys;</span>
						}
<span class="nc bnc" id="L857" title="All 2 branches missed.">						if (keycode == Keys.RIGHT) {</span>
<span class="nc" id="L858">							moveCursor(true, jump);</span>
<span class="nc" id="L859">							repeat = true;</span>
<span class="nc" id="L860">							break keys;</span>
						}
<span class="nc bnc" id="L862" title="All 2 branches missed.">						if (keycode == Keys.HOME) {</span>
<span class="nc" id="L863">							goHome(jump);</span>
<span class="nc" id="L864">							break keys;</span>
						}
<span class="nc bnc" id="L866" title="All 2 branches missed.">						if (keycode == Keys.END) {</span>
<span class="nc" id="L867">							goEnd(jump);</span>
							break keys;
						}
						break selection;
					}
<span class="nc bnc" id="L872" title="All 2 branches missed.">					if (!hasSelection) {</span>
<span class="nc" id="L873">						selectionStart = temp;</span>
<span class="nc" id="L874">						hasSelection = true;</span>
					}
<span class="nc" id="L876">				}</span>
			} else {
				// Cursor movement or other keys (kills selection).
<span class="nc bnc" id="L879" title="All 2 branches missed.">				if (keycode == Keys.LEFT) {</span>
<span class="nc" id="L880">					moveCursor(false, jump);</span>
<span class="nc" id="L881">					clearSelection();</span>
<span class="nc" id="L882">					repeat = true;</span>
				}
<span class="nc bnc" id="L884" title="All 2 branches missed.">				if (keycode == Keys.RIGHT) {</span>
<span class="nc" id="L885">					moveCursor(true, jump);</span>
<span class="nc" id="L886">					clearSelection();</span>
<span class="nc" id="L887">					repeat = true;</span>
				}
<span class="nc bnc" id="L889" title="All 2 branches missed.">				if (keycode == Keys.HOME) {</span>
<span class="nc" id="L890">					goHome(jump);</span>
<span class="nc" id="L891">					clearSelection();</span>
				}
<span class="nc bnc" id="L893" title="All 2 branches missed.">				if (keycode == Keys.END) {</span>
<span class="nc" id="L894">					goEnd(jump);</span>
<span class="nc" id="L895">					clearSelection();</span>
				}
			}
<span class="nc" id="L898">			cursor = MathUtils.clamp(cursor, 0, text.length());</span>

<span class="nc bnc" id="L900" title="All 2 branches missed.">			if (repeat) {</span>
<span class="nc" id="L901">				scheduleKeyRepeatTask(keycode);</span>
			}
<span class="nc" id="L903">			return true;</span>
		}

		protected void scheduleKeyRepeatTask (int keycode) {
<span class="nc bnc" id="L907" title="All 4 branches missed.">			if (!keyRepeatTask.isScheduled() || keyRepeatTask.keycode != keycode) {</span>
<span class="nc" id="L908">				keyRepeatTask.keycode = keycode;</span>
<span class="nc" id="L909">				keyRepeatTask.cancel();</span>
<span class="nc" id="L910">				Timer.schedule(keyRepeatTask, keyRepeatInitialTime, keyRepeatTime);</span>
			}
<span class="nc" id="L912">		}</span>

		public boolean keyUp (InputEvent event, int keycode) {
<span class="nc bnc" id="L915" title="All 2 branches missed.">			if (disabled) return false;</span>
<span class="nc" id="L916">			keyRepeatTask.cancel();</span>
<span class="nc" id="L917">			return true;</span>
		}

		public boolean keyTyped (InputEvent event, char character) {
<span class="nc bnc" id="L921" title="All 2 branches missed.">			if (disabled) return false;</span>

			// Disallow &quot;typing&quot; most ASCII control characters, which would show up as a space when onlyFontChars is true.
<span class="nc bnc" id="L924" title="All 2 branches missed.">			switch (character) {</span>
			case BACKSPACE:
			case TAB:
			case ENTER_ANDROID:
			case ENTER_DESKTOP:
<span class="nc" id="L929">				break;</span>
			default:
<span class="nc bnc" id="L931" title="All 2 branches missed.">				if (character &lt; 32) return false;</span>
			}

<span class="nc" id="L934">			Stage stage = getStage();</span>
<span class="nc bnc" id="L935" title="All 4 branches missed.">			if (stage == null || stage.getKeyboardFocus() != TextField.this) return false;</span>

<span class="nc bnc" id="L937" title="All 4 branches missed.">			if (UIUtils.isMac &amp;&amp; Gdx.input.isKeyPressed(Keys.SYM)) return true;</span>

<span class="nc bnc" id="L939" title="All 6 branches missed.">			if ((character == TAB || character == ENTER_ANDROID) &amp;&amp; focusTraversal) {</span>
<span class="nc" id="L940">				next(UIUtils.shift());</span>
			} else {
<span class="nc bnc" id="L942" title="All 2 branches missed.">				boolean delete = character == DELETE;</span>
<span class="nc bnc" id="L943" title="All 2 branches missed.">				boolean backspace = character == BACKSPACE;</span>
<span class="nc bnc" id="L944" title="All 4 branches missed.">				boolean enter = character == ENTER_DESKTOP || character == ENTER_ANDROID;</span>
<span class="nc bnc" id="L945" title="All 6 branches missed.">				boolean add = enter ? writeEnters : (!onlyFontChars || style.font.getData().hasGlyph(character));</span>
<span class="nc bnc" id="L946" title="All 4 branches missed.">				boolean remove = backspace || delete;</span>
<span class="nc bnc" id="L947" title="All 4 branches missed.">				if (add || remove) {</span>
<span class="nc" id="L948">					String oldText = text;</span>
<span class="nc" id="L949">					int oldCursor = cursor;</span>
<span class="nc bnc" id="L950" title="All 2 branches missed.">					if (hasSelection)</span>
<span class="nc" id="L951">						cursor = delete(false);</span>
					else {
<span class="nc bnc" id="L953" title="All 4 branches missed.">						if (backspace &amp;&amp; cursor &gt; 0) {</span>
<span class="nc" id="L954">							text = text.substring(0, cursor - 1) + text.substring(cursor--);</span>
<span class="nc" id="L955">							renderOffset = 0;</span>
						}
<span class="nc bnc" id="L957" title="All 4 branches missed.">						if (delete &amp;&amp; cursor &lt; text.length()) {</span>
<span class="nc" id="L958">							text = text.substring(0, cursor) + text.substring(cursor + 1);</span>
						}
					}
<span class="nc bnc" id="L961" title="All 4 branches missed.">					if (add &amp;&amp; !remove) {</span>
						// Character may be added to the text.
<span class="nc bnc" id="L963" title="All 6 branches missed.">						if (!enter &amp;&amp; filter != null &amp;&amp; !filter.acceptChar(TextField.this, character)) return true;</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">						if (!withinMaxLength(text.length())) return true;</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">						String insertion = enter ? &quot;\n&quot; : String.valueOf(character);</span>
<span class="nc" id="L966">						text = insert(cursor++, insertion, text);</span>
					}
<span class="nc bnc" id="L968" title="All 2 branches missed.">					if (!changeText(oldText, text)) cursor = oldCursor;</span>
<span class="nc" id="L969">					updateDisplayText();</span>
				}
			}
<span class="nc bnc" id="L972" title="All 2 branches missed.">			if (listener != null) listener.keyTyped(TextField.this, character);</span>
<span class="nc" id="L973">			return true;</span>
		}
	}

	/** The style for a text field, see {@link TextField}.
	 * @author mzechner
	 * @author Nathan Sweet */
	static public class TextFieldStyle {
		public BitmapFont font;
		public Color fontColor;
		/** Optional. */
		public Color focusedFontColor, disabledFontColor;
		/** Optional. */
		public Drawable background, focusedBackground, disabledBackground, cursor, selection;
		/** Optional. */
		public BitmapFont messageFont;
		/** Optional. */
		public Color messageFontColor;

<span class="nc" id="L992">		public TextFieldStyle () {</span>
<span class="nc" id="L993">		}</span>

<span class="nc" id="L995">		public TextFieldStyle (BitmapFont font, Color fontColor, Drawable cursor, Drawable selection, Drawable background) {</span>
<span class="nc" id="L996">			this.background = background;</span>
<span class="nc" id="L997">			this.cursor = cursor;</span>
<span class="nc" id="L998">			this.font = font;</span>
<span class="nc" id="L999">			this.fontColor = fontColor;</span>
<span class="nc" id="L1000">			this.selection = selection;</span>
<span class="nc" id="L1001">		}</span>

<span class="nc" id="L1003">		public TextFieldStyle (TextFieldStyle style) {</span>
<span class="nc" id="L1004">			this.messageFont = style.messageFont;</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">			if (style.messageFontColor != null) this.messageFontColor = new Color(style.messageFontColor);</span>
<span class="nc" id="L1006">			this.background = style.background;</span>
<span class="nc" id="L1007">			this.focusedBackground = style.focusedBackground;</span>
<span class="nc" id="L1008">			this.disabledBackground = style.disabledBackground;</span>
<span class="nc" id="L1009">			this.cursor = style.cursor;</span>
<span class="nc" id="L1010">			this.font = style.font;</span>
<span class="nc bnc" id="L1011" title="All 2 branches missed.">			if (style.fontColor != null) this.fontColor = new Color(style.fontColor);</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">			if (style.focusedFontColor != null) this.focusedFontColor = new Color(style.focusedFontColor);</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">			if (style.disabledFontColor != null) this.disabledFontColor = new Color(style.disabledFontColor);</span>
<span class="nc" id="L1014">			this.selection = style.selection;</span>
<span class="nc" id="L1015">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.5.201112152213</span></div></body></html>