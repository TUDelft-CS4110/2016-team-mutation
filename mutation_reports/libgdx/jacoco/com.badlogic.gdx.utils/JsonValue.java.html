<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>JsonValue.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">libGDX Core</a> &gt; <a href="index.html" class="el_package">com.badlogic.gdx.utils</a> &gt; <span class="el_source">JsonValue.java</span></div><h1>JsonValue.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright 2011 See AUTHORS file.
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

package com.badlogic.gdx.utils;

import java.util.Iterator;
import java.util.NoSuchElementException;

import com.badlogic.gdx.utils.JsonWriter.OutputType;

/** Container for a JSON object, array, string, double, long, boolean, or null.
 * &lt;p&gt;
 * JsonValue children are a linked list. Iteration of arrays or objects is easily done using a for loop, either with the enhanced
 * for loop syntactic sugar or like the example below. This is much more efficient than accessing children by index when there are
 * many children.&lt;br&gt;
 * 
 * &lt;pre&gt;
 * JsonValue map = ...;
 * for (JsonValue entry = map.child; entry != null; entry = entry.next)
 * 	System.out.println(entry.name + &quot; = &quot; + entry.asString());
 * &lt;/pre&gt;
 * 
 * @author Nathan Sweet */
public class JsonValue implements Iterable&lt;JsonValue&gt; {
	private ValueType type;

	/** May be null. */
	private String stringValue;
	private double doubleValue;
	private long longValue;

	public String name;
	/** May be null. */
	public JsonValue child, next, prev, parent;
	public int size;

<span class="nc" id="L50">	public JsonValue (ValueType type) {</span>
<span class="nc" id="L51">		this.type = type;</span>
<span class="nc" id="L52">	}</span>

	/** @param value May be null. */
<span class="nc" id="L55">	public JsonValue (String value) {</span>
<span class="nc" id="L56">		set(value);</span>
<span class="nc" id="L57">	}</span>

<span class="nc" id="L59">	public JsonValue (double value) {</span>
<span class="nc" id="L60">		set(value, null);</span>
<span class="nc" id="L61">	}</span>

<span class="nc" id="L63">	public JsonValue (long value) {</span>
<span class="nc" id="L64">		set(value, null);</span>
<span class="nc" id="L65">	}</span>

<span class="nc" id="L67">	public JsonValue (double value, String stringValue) {</span>
<span class="nc" id="L68">		set(value, stringValue);</span>
<span class="nc" id="L69">	}</span>

<span class="nc" id="L71">	public JsonValue (long value, String stringValue) {</span>
<span class="nc" id="L72">		set(value, stringValue);</span>
<span class="nc" id="L73">	}</span>

<span class="nc" id="L75">	public JsonValue (boolean value) {</span>
<span class="nc" id="L76">		set(value);</span>
<span class="nc" id="L77">	}</span>

	/** Returns the child at the specified index. This requires walking the linked list to the specified entry, see
	 * {@link JsonValue} for how to iterate efficiently.
	 * @return May be null. */
	public JsonValue get (int index) {
<span class="nc" id="L83">		JsonValue current = child;</span>
<span class="nc bnc" id="L84" title="All 4 branches missed.">		while (current != null &amp;&amp; index &gt; 0) {</span>
<span class="nc" id="L85">			index--;</span>
<span class="nc" id="L86">			current = current.next;</span>
		}
<span class="nc" id="L88">		return current;</span>
	}

	/** Returns the child with the specified name.
	 * @return May be null. */
	public JsonValue get (String name) {
<span class="nc" id="L94">		JsonValue current = child;</span>
<span class="nc bnc" id="L95" title="All 4 branches missed.">		while (current != null &amp;&amp; !current.name.equalsIgnoreCase(name))</span>
<span class="nc" id="L96">			current = current.next;</span>
<span class="nc" id="L97">		return current;</span>
	}

	/** Returns true if a child with the specified name exists. */
	public boolean has (String name) {
<span class="nc bnc" id="L102" title="All 2 branches missed.">		return get(name) != null;</span>
	}

	/** Returns the child at the specified index. This requires walking the linked list to the specified entry, see
	 * {@link JsonValue} for how to iterate efficiently.
	 * @throws IllegalArgumentException if the child was not found. */
	public JsonValue require (int index) {
<span class="nc" id="L109">		JsonValue current = child;</span>
<span class="nc bnc" id="L110" title="All 4 branches missed.">		while (current != null &amp;&amp; index &gt; 0) {</span>
<span class="nc" id="L111">			index--;</span>
<span class="nc" id="L112">			current = current.next;</span>
		}
<span class="nc bnc" id="L114" title="All 2 branches missed.">		if (current == null) throw new IllegalArgumentException(&quot;Child not found with index: &quot; + index);</span>
<span class="nc" id="L115">		return current;</span>
	}

	/** Returns the child with the specified name.
	 * @throws IllegalArgumentException if the child was not found. */
	public JsonValue require (String name) {
<span class="nc" id="L121">		JsonValue current = child;</span>
<span class="nc bnc" id="L122" title="All 4 branches missed.">		while (current != null &amp;&amp; !current.name.equalsIgnoreCase(name))</span>
<span class="nc" id="L123">			current = current.next;</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (current == null) throw new IllegalArgumentException(&quot;Child not found with name: &quot; + name);</span>
<span class="nc" id="L125">		return current;</span>
	}

	/** Removes the child with the specified index. This requires walking the linked list to the specified entry, see
	 * {@link JsonValue} for how to iterate efficiently.
	 * @return May be null. */
	public JsonValue remove (int index) {
<span class="nc" id="L132">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">		if (child == null) return null;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">		if (child.prev == null) {</span>
<span class="nc" id="L135">			this.child = child.next;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">			if (this.child != null) this.child.prev = null;</span>
		} else {
<span class="nc" id="L138">			child.prev.next = child.next;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">			if (child.next != null) child.next.prev = child.prev;</span>
		}
<span class="nc" id="L141">		size--;</span>
<span class="nc" id="L142">		return child;</span>
	}

	/** Removes the child with the specified name.
	 * @return May be null. */
	public JsonValue remove (String name) {
<span class="nc" id="L148">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (child == null) return null;</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">		if (child.prev == null) {</span>
<span class="nc" id="L151">			this.child = child.next;</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (this.child != null) this.child.prev = null;</span>
		} else {
<span class="nc" id="L154">			child.prev.next = child.next;</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">			if (child.next != null) child.next.prev = child.prev;</span>
		}
<span class="nc" id="L157">		size--;</span>
<span class="nc" id="L158">		return child;</span>
	}

	/** @deprecated Use the size property instead. Returns this number of children in the array or object. */
	@Deprecated
	public int size () {
<span class="nc" id="L164">		return size;</span>
	}

	/** Returns this value as a string.
	 * @return May be null if this value is null.
	 * @throws IllegalStateException if this an array or object. */
	public String asString () {
<span class="nc bnc" id="L171" title="All 6 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L173">			return stringValue;</span>
		case doubleValue:
<span class="nc bnc" id="L175" title="All 2 branches missed.">			return stringValue != null ? stringValue : Double.toString(doubleValue);</span>
		case longValue:
<span class="nc bnc" id="L177" title="All 2 branches missed.">			return stringValue != null ? stringValue : Long.toString(longValue);</span>
		case booleanValue:
<span class="nc bnc" id="L179" title="All 2 branches missed.">			return longValue != 0 ? &quot;true&quot; : &quot;false&quot;;</span>
		case nullValue:
<span class="nc" id="L181">			return null;</span>
		}
<span class="nc" id="L183">		throw new IllegalStateException(&quot;Value cannot be converted to string: &quot; + type);</span>
	}

	/** Returns this value as a float.
	 * @throws IllegalStateException if this an array or object. */
	public float asFloat () {
<span class="nc bnc" id="L189" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L191">			return Float.parseFloat(stringValue);</span>
		case doubleValue:
<span class="nc" id="L193">			return (float)doubleValue;</span>
		case longValue:
<span class="nc" id="L195">			return (float)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L197" title="All 2 branches missed.">			return longValue != 0 ? 1 : 0;</span>
		}
<span class="nc" id="L199">		throw new IllegalStateException(&quot;Value cannot be converted to float: &quot; + type);</span>
	}

	/** Returns this value as a double.
	 * @throws IllegalStateException if this an array or object. */
	public double asDouble () {
<span class="nc bnc" id="L205" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L207">			return Double.parseDouble(stringValue);</span>
		case doubleValue:
<span class="nc" id="L209">			return doubleValue;</span>
		case longValue:
<span class="nc" id="L211">			return (double)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L213" title="All 2 branches missed.">			return longValue != 0 ? 1 : 0;</span>
		}
<span class="nc" id="L215">		throw new IllegalStateException(&quot;Value cannot be converted to double: &quot; + type);</span>
	}

	/** Returns this value as a long.
	 * @throws IllegalStateException if this an array or object. */
	public long asLong () {
<span class="nc bnc" id="L221" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L223">			return Long.parseLong(stringValue);</span>
		case doubleValue:
<span class="nc" id="L225">			return (long)doubleValue;</span>
		case longValue:
<span class="nc" id="L227">			return longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L229" title="All 2 branches missed.">			return longValue != 0 ? 1 : 0;</span>
		}
<span class="nc" id="L231">		throw new IllegalStateException(&quot;Value cannot be converted to long: &quot; + type);</span>
	}

	/** Returns this value as an int.
	 * @throws IllegalStateException if this an array or object. */
	public int asInt () {
<span class="nc bnc" id="L237" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L239">			return Integer.parseInt(stringValue);</span>
		case doubleValue:
<span class="nc" id="L241">			return (int)doubleValue;</span>
		case longValue:
<span class="nc" id="L243">			return (int)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L245" title="All 2 branches missed.">			return longValue != 0 ? 1 : 0;</span>
		}
<span class="nc" id="L247">		throw new IllegalStateException(&quot;Value cannot be converted to int: &quot; + type);</span>
	}

	/** Returns this value as a boolean.
	 * @throws IllegalStateException if this an array or object. */
	public boolean asBoolean () {
<span class="nc bnc" id="L253" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L255">			return stringValue.equalsIgnoreCase(&quot;true&quot;);</span>
		case doubleValue:
<span class="nc bnc" id="L257" title="All 2 branches missed.">			return doubleValue != 0;</span>
		case longValue:
<span class="nc bnc" id="L259" title="All 2 branches missed.">			return longValue != 0;</span>
		case booleanValue:
<span class="nc bnc" id="L261" title="All 2 branches missed.">			return longValue != 0;</span>
		}
<span class="nc" id="L263">		throw new IllegalStateException(&quot;Value cannot be converted to boolean: &quot; + type);</span>
	}

	/** Returns this value as a byte.
	 * @throws IllegalStateException if this an array or object. */
	public byte asByte () {
<span class="nc bnc" id="L269" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L271">			return Byte.parseByte(stringValue);</span>
		case doubleValue:
<span class="nc" id="L273">			return (byte)doubleValue;</span>
		case longValue:
<span class="nc" id="L275">			return (byte)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L277" title="All 2 branches missed.">			return longValue != 0 ? (byte)1 : 0;</span>
		}
<span class="nc" id="L279">		throw new IllegalStateException(&quot;Value cannot be converted to byte: &quot; + type);</span>
	}

	/** Returns this value as a short.
	 * @throws IllegalStateException if this an array or object. */
	public short asShort () {
<span class="nc bnc" id="L285" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc" id="L287">			return Short.parseShort(stringValue);</span>
		case doubleValue:
<span class="nc" id="L289">			return (short)doubleValue;</span>
		case longValue:
<span class="nc" id="L291">			return (short)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L293" title="All 2 branches missed.">			return longValue != 0 ? (short)1 : 0;</span>
		}
<span class="nc" id="L295">		throw new IllegalStateException(&quot;Value cannot be converted to short: &quot; + type);</span>
	}

	/** Returns this value as a char.
	 * @throws IllegalStateException if this an array or object. */
	public char asChar () {
<span class="nc bnc" id="L301" title="All 5 branches missed.">		switch (type) {</span>
		case stringValue:
<span class="nc bnc" id="L303" title="All 2 branches missed.">			return stringValue.length() == 0 ? 0 : stringValue.charAt(0);</span>
		case doubleValue:
<span class="nc" id="L305">			return (char)doubleValue;</span>
		case longValue:
<span class="nc" id="L307">			return (char)longValue;</span>
		case booleanValue:
<span class="nc bnc" id="L309" title="All 2 branches missed.">			return longValue != 0 ? (char)1 : 0;</span>
		}
<span class="nc" id="L311">		throw new IllegalStateException(&quot;Value cannot be converted to char: &quot; + type);</span>
	}

	/** Returns the children of this value as a newly allocated String array.
	 * @throws IllegalStateException if this is not an array. */
	public String[] asStringArray () {
<span class="nc bnc" id="L317" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L318">		String[] array = new String[size];</span>
<span class="nc" id="L319">		int i = 0;</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			String v;
<span class="nc bnc" id="L322" title="All 6 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L324">				v = value.stringValue;</span>
<span class="nc" id="L325">				break;</span>
			case doubleValue:
<span class="nc bnc" id="L327" title="All 2 branches missed.">				v = stringValue != null ? stringValue : Double.toString(value.doubleValue);</span>
<span class="nc" id="L328">				break;</span>
			case longValue:
<span class="nc bnc" id="L330" title="All 2 branches missed.">				v = stringValue != null ? stringValue : Long.toString(value.longValue);</span>
<span class="nc" id="L331">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L333" title="All 2 branches missed.">				v = value.longValue != 0 ? &quot;true&quot; : &quot;false&quot;;</span>
<span class="nc" id="L334">				break;</span>
			case nullValue:
<span class="nc" id="L336">				v = null;</span>
<span class="nc" id="L337">				break;</span>
			default:
<span class="nc" id="L339">				throw new IllegalStateException(&quot;Value cannot be converted to string: &quot; + value.type);</span>
			}
<span class="nc" id="L341">			array[i] = v;</span>
		}
<span class="nc" id="L343">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated float array.
	 * @throws IllegalStateException if this is not an array. */
	public float[] asFloatArray () {
<span class="nc bnc" id="L349" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L350">		float[] array = new float[size];</span>
<span class="nc" id="L351">		int i = 0;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			float v;
<span class="nc bnc" id="L354" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L356">				v = Float.parseFloat(value.stringValue);</span>
<span class="nc" id="L357">				break;</span>
			case doubleValue:
<span class="nc" id="L359">				v = (float)value.doubleValue;</span>
<span class="nc" id="L360">				break;</span>
			case longValue:
<span class="nc" id="L362">				v = (float)value.longValue;</span>
<span class="nc" id="L363">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L365" title="All 2 branches missed.">				v = value.longValue != 0 ? 1 : 0;</span>
<span class="nc" id="L366">				break;</span>
			default:
<span class="nc" id="L368">				throw new IllegalStateException(&quot;Value cannot be converted to float: &quot; + value.type);</span>
			}
<span class="nc" id="L370">			array[i] = v;</span>
		}
<span class="nc" id="L372">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated double array.
	 * @throws IllegalStateException if this is not an array. */
	public double[] asDoubleArray () {
<span class="nc bnc" id="L378" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L379">		double[] array = new double[size];</span>
<span class="nc" id="L380">		int i = 0;</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			double v;
<span class="nc bnc" id="L383" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L385">				v = Double.parseDouble(value.stringValue);</span>
<span class="nc" id="L386">				break;</span>
			case doubleValue:
<span class="nc" id="L388">				v = value.doubleValue;</span>
<span class="nc" id="L389">				break;</span>
			case longValue:
<span class="nc" id="L391">				v = (double)value.longValue;</span>
<span class="nc" id="L392">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L394" title="All 2 branches missed.">				v = value.longValue != 0 ? 1 : 0;</span>
<span class="nc" id="L395">				break;</span>
			default:
<span class="nc" id="L397">				throw new IllegalStateException(&quot;Value cannot be converted to double: &quot; + value.type);</span>
			}
<span class="nc" id="L399">			array[i] = v;</span>
		}
<span class="nc" id="L401">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated long array.
	 * @throws IllegalStateException if this is not an array. */
	public long[] asLongArray () {
<span class="nc bnc" id="L407" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L408">		long[] array = new long[size];</span>
<span class="nc" id="L409">		int i = 0;</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			long v;
<span class="nc bnc" id="L412" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L414">				v = Long.parseLong(value.stringValue);</span>
<span class="nc" id="L415">				break;</span>
			case doubleValue:
<span class="nc" id="L417">				v = (long)value.doubleValue;</span>
<span class="nc" id="L418">				break;</span>
			case longValue:
<span class="nc" id="L420">				v = value.longValue;</span>
<span class="nc" id="L421">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L423" title="All 2 branches missed.">				v = value.longValue != 0 ? 1 : 0;</span>
<span class="nc" id="L424">				break;</span>
			default:
<span class="nc" id="L426">				throw new IllegalStateException(&quot;Value cannot be converted to long: &quot; + value.type);</span>
			}
<span class="nc" id="L428">			array[i] = v;</span>
		}
<span class="nc" id="L430">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated int array.
	 * @throws IllegalStateException if this is not an array. */
	public int[] asIntArray () {
<span class="nc bnc" id="L436" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L437">		int[] array = new int[size];</span>
<span class="nc" id="L438">		int i = 0;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			int v;
<span class="nc bnc" id="L441" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L443">				v = Integer.parseInt(value.stringValue);</span>
<span class="nc" id="L444">				break;</span>
			case doubleValue:
<span class="nc" id="L446">				v = (int)value.doubleValue;</span>
<span class="nc" id="L447">				break;</span>
			case longValue:
<span class="nc" id="L449">				v = (int)value.longValue;</span>
<span class="nc" id="L450">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L452" title="All 2 branches missed.">				v = value.longValue != 0 ? 1 : 0;</span>
<span class="nc" id="L453">				break;</span>
			default:
<span class="nc" id="L455">				throw new IllegalStateException(&quot;Value cannot be converted to int: &quot; + value.type);</span>
			}
<span class="nc" id="L457">			array[i] = v;</span>
		}
<span class="nc" id="L459">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated boolean array.
	 * @throws IllegalStateException if this is not an array. */
	public boolean[] asBooleanArray () {
<span class="nc bnc" id="L465" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L466">		boolean[] array = new boolean[size];</span>
<span class="nc" id="L467">		int i = 0;</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			boolean v;
<span class="nc bnc" id="L470" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L472">				v = Boolean.parseBoolean(value.stringValue);</span>
<span class="nc" id="L473">				break;</span>
			case doubleValue:
<span class="nc bnc" id="L475" title="All 2 branches missed.">				v = value.doubleValue == 0;</span>
<span class="nc" id="L476">				break;</span>
			case longValue:
<span class="nc bnc" id="L478" title="All 2 branches missed.">				v = value.longValue == 0;</span>
<span class="nc" id="L479">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L481" title="All 2 branches missed.">				v = value.longValue != 0;</span>
<span class="nc" id="L482">				break;</span>
			default:
<span class="nc" id="L484">				throw new IllegalStateException(&quot;Value cannot be converted to boolean: &quot; + value.type);</span>
			}
<span class="nc" id="L486">			array[i] = v;</span>
		}
<span class="nc" id="L488">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated byte array.
	 * @throws IllegalStateException if this is not an array. */
	public byte[] asByteArray () {
<span class="nc bnc" id="L494" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L495">		byte[] array = new byte[size];</span>
<span class="nc" id="L496">		int i = 0;</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			byte v;
<span class="nc bnc" id="L499" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L501">				v = Byte.parseByte(value.stringValue);</span>
<span class="nc" id="L502">				break;</span>
			case doubleValue:
<span class="nc" id="L504">				v = (byte)value.doubleValue;</span>
<span class="nc" id="L505">				break;</span>
			case longValue:
<span class="nc" id="L507">				v = (byte)value.longValue;</span>
<span class="nc" id="L508">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L510" title="All 2 branches missed.">				v = value.longValue != 0 ? (byte)1 : 0;</span>
<span class="nc" id="L511">				break;</span>
			default:
<span class="nc" id="L513">				throw new IllegalStateException(&quot;Value cannot be converted to byte: &quot; + value.type);</span>
			}
<span class="nc" id="L515">			array[i] = v;</span>
		}
<span class="nc" id="L517">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated short array.
	 * @throws IllegalStateException if this is not an array. */
	public short[] asShortArray () {
<span class="nc bnc" id="L523" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L524">		short[] array = new short[size];</span>
<span class="nc" id="L525">		int i = 0;</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			short v;
<span class="nc bnc" id="L528" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc" id="L530">				v = Short.parseShort(value.stringValue);</span>
<span class="nc" id="L531">				break;</span>
			case doubleValue:
<span class="nc" id="L533">				v = (short)value.doubleValue;</span>
<span class="nc" id="L534">				break;</span>
			case longValue:
<span class="nc" id="L536">				v = (short)value.longValue;</span>
<span class="nc" id="L537">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L539" title="All 2 branches missed.">				v = value.longValue != 0 ? (short)1 : 0;</span>
<span class="nc" id="L540">				break;</span>
			default:
<span class="nc" id="L542">				throw new IllegalStateException(&quot;Value cannot be converted to short: &quot; + value.type);</span>
			}
<span class="nc" id="L544">			array[i] = v;</span>
		}
<span class="nc" id="L546">		return array;</span>
	}

	/** Returns the children of this value as a newly allocated char array.
	 * @throws IllegalStateException if this is not an array. */
	public char[] asCharArray () {
<span class="nc bnc" id="L552" title="All 2 branches missed.">		if (type != ValueType.array) throw new IllegalStateException(&quot;Value is not an array: &quot; + type);</span>
<span class="nc" id="L553">		char[] array = new char[size];</span>
<span class="nc" id="L554">		int i = 0;</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">		for (JsonValue value = child; value != null; value = value.next, i++) {</span>
			char v;
<span class="nc bnc" id="L557" title="All 5 branches missed.">			switch (value.type) {</span>
			case stringValue:
<span class="nc bnc" id="L559" title="All 2 branches missed.">				v = value.stringValue.length() == 0 ? 0 : value.stringValue.charAt(0);</span>
<span class="nc" id="L560">				break;</span>
			case doubleValue:
<span class="nc" id="L562">				v = (char)value.doubleValue;</span>
<span class="nc" id="L563">				break;</span>
			case longValue:
<span class="nc" id="L565">				v = (char)value.longValue;</span>
<span class="nc" id="L566">				break;</span>
			case booleanValue:
<span class="nc bnc" id="L568" title="All 2 branches missed.">				v = value.longValue != 0 ? (char)1 : 0;</span>
<span class="nc" id="L569">				break;</span>
			default:
<span class="nc" id="L571">				throw new IllegalStateException(&quot;Value cannot be converted to char: &quot; + value.type);</span>
			}
<span class="nc" id="L573">			array[i] = v;</span>
		}
<span class="nc" id="L575">		return array;</span>
	}

	/** Returns true if a child with the specified name exists and has a child. */
	public boolean hasChild (String name) {
<span class="nc bnc" id="L580" title="All 2 branches missed.">		return getChild(name) != null;</span>
	}

	/** Finds the child with the specified name and returns its first child.
	 * @return May be null. */
	public JsonValue getChild (String name) {
<span class="nc" id="L586">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">		return child == null ? null : child.child;</span>
	}

	/** Finds the child with the specified name and returns it as a string. Returns defaultValue if not found.
	 * @param defaultValue May be null. */
	public String getString (String name, String defaultValue) {
<span class="nc" id="L593">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L594" title="All 6 branches missed.">		return (child == null || !child.isValue() || child.isNull()) ? defaultValue : child.asString();</span>
	}

	/** Finds the child with the specified name and returns it as a float. Returns defaultValue if not found. */
	public float getFloat (String name, float defaultValue) {
<span class="nc" id="L599">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L600" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asFloat();</span>
	}

	/** Finds the child with the specified name and returns it as a double. Returns defaultValue if not found. */
	public double getDouble (String name, double defaultValue) {
<span class="nc" id="L605">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L606" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asDouble();</span>
	}

	/** Finds the child with the specified name and returns it as a long. Returns defaultValue if not found. */
	public long getLong (String name, long defaultValue) {
<span class="nc" id="L611">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L612" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asLong();</span>
	}

	/** Finds the child with the specified name and returns it as an int. Returns defaultValue if not found. */
	public int getInt (String name, int defaultValue) {
<span class="nc" id="L617">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L618" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asInt();</span>
	}

	/** Finds the child with the specified name and returns it as a boolean. Returns defaultValue if not found. */
	public boolean getBoolean (String name, boolean defaultValue) {
<span class="nc" id="L623">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L624" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asBoolean();</span>
	}

	/** Finds the child with the specified name and returns it as a byte. Returns defaultValue if not found. */
	public byte getByte (String name, byte defaultValue) {
<span class="nc" id="L629">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L630" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asByte();</span>
	}

	/** Finds the child with the specified name and returns it as a short. Returns defaultValue if not found. */
	public short getShort (String name, short defaultValue) {
<span class="nc" id="L635">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L636" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asShort();</span>
	}

	/** Finds the child with the specified name and returns it as a char. Returns defaultValue if not found. */
	public char getChar (String name, char defaultValue) {
<span class="nc" id="L641">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L642" title="All 4 branches missed.">		return (child == null || !child.isValue()) ? defaultValue : child.asChar();</span>
	}

	/** Finds the child with the specified name and returns it as a string.
	 * @throws IllegalArgumentException if the child was not found. */
	public String getString (String name) {
<span class="nc" id="L648">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L649" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L650">		return child.asString();</span>
	}

	/** Finds the child with the specified name and returns it as a float.
	 * @throws IllegalArgumentException if the child was not found. */
	public float getFloat (String name) {
<span class="nc" id="L656">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L657" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L658">		return child.asFloat();</span>
	}

	/** Finds the child with the specified name and returns it as a double.
	 * @throws IllegalArgumentException if the child was not found. */
	public double getDouble (String name) {
<span class="nc" id="L664">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L666">		return child.asDouble();</span>
	}

	/** Finds the child with the specified name and returns it as a long.
	 * @throws IllegalArgumentException if the child was not found. */
	public long getLong (String name) {
<span class="nc" id="L672">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L673" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L674">		return child.asLong();</span>
	}

	/** Finds the child with the specified name and returns it as an int.
	 * @throws IllegalArgumentException if the child was not found. */
	public int getInt (String name) {
<span class="nc" id="L680">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L682">		return child.asInt();</span>
	}

	/** Finds the child with the specified name and returns it as a boolean.
	 * @throws IllegalArgumentException if the child was not found. */
	public boolean getBoolean (String name) {
<span class="nc" id="L688">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L690">		return child.asBoolean();</span>
	}

	/** Finds the child with the specified name and returns it as a byte.
	 * @throws IllegalArgumentException if the child was not found. */
	public byte getByte (String name) {
<span class="nc" id="L696">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L697" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L698">		return child.asByte();</span>
	}

	/** Finds the child with the specified name and returns it as a short.
	 * @throws IllegalArgumentException if the child was not found. */
	public short getShort (String name) {
<span class="nc" id="L704">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L706">		return child.asShort();</span>
	}

	/** Finds the child with the specified name and returns it as a char.
	 * @throws IllegalArgumentException if the child was not found. */
	public char getChar (String name) {
<span class="nc" id="L712">		JsonValue child = get(name);</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Named value not found: &quot; + name);</span>
<span class="nc" id="L714">		return child.asChar();</span>
	}

	/** Finds the child with the specified index and returns it as a string.
	 * @throws IllegalArgumentException if the child was not found. */
	public String getString (int index) {
<span class="nc" id="L720">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L721" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L722">		return child.asString();</span>
	}

	/** Finds the child with the specified index and returns it as a float.
	 * @throws IllegalArgumentException if the child was not found. */
	public float getFloat (int index) {
<span class="nc" id="L728">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L730">		return child.asFloat();</span>
	}

	/** Finds the child with the specified index and returns it as a double.
	 * @throws IllegalArgumentException if the child was not found. */
	public double getDouble (int index) {
<span class="nc" id="L736">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L738">		return child.asDouble();</span>
	}

	/** Finds the child with the specified index and returns it as a long.
	 * @throws IllegalArgumentException if the child was not found. */
	public long getLong (int index) {
<span class="nc" id="L744">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L746">		return child.asLong();</span>
	}

	/** Finds the child with the specified index and returns it as an int.
	 * @throws IllegalArgumentException if the child was not found. */
	public int getInt (int index) {
<span class="nc" id="L752">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L754">		return child.asInt();</span>
	}

	/** Finds the child with the specified index and returns it as a boolean.
	 * @throws IllegalArgumentException if the child was not found. */
	public boolean getBoolean (int index) {
<span class="nc" id="L760">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L762">		return child.asBoolean();</span>
	}

	/** Finds the child with the specified index and returns it as a byte.
	 * @throws IllegalArgumentException if the child was not found. */
	public byte getByte (int index) {
<span class="nc" id="L768">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L769" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L770">		return child.asByte();</span>
	}

	/** Finds the child with the specified index and returns it as a short.
	 * @throws IllegalArgumentException if the child was not found. */
	public short getShort (int index) {
<span class="nc" id="L776">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L777" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L778">		return child.asShort();</span>
	}

	/** Finds the child with the specified index and returns it as a char.
	 * @throws IllegalArgumentException if the child was not found. */
	public char getChar (int index) {
<span class="nc" id="L784">		JsonValue child = get(index);</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">		if (child == null) throw new IllegalArgumentException(&quot;Indexed value not found: &quot; + name);</span>
<span class="nc" id="L786">		return child.asChar();</span>
	}

	public ValueType type () {
<span class="nc" id="L790">		return type;</span>
	}

	public void setType (ValueType type) {
<span class="nc bnc" id="L794" title="All 2 branches missed.">		if (type == null) throw new IllegalArgumentException(&quot;type cannot be null.&quot;);</span>
<span class="nc" id="L795">		this.type = type;</span>
<span class="nc" id="L796">	}</span>

	public boolean isArray () {
<span class="nc bnc" id="L799" title="All 2 branches missed.">		return type == ValueType.array;</span>
	}

	public boolean isObject () {
<span class="nc bnc" id="L803" title="All 2 branches missed.">		return type == ValueType.object;</span>
	}

	public boolean isString () {
<span class="nc bnc" id="L807" title="All 2 branches missed.">		return type == ValueType.stringValue;</span>
	}

	/** Returns true if this is a double or long value. */
	public boolean isNumber () {
<span class="nc bnc" id="L812" title="All 4 branches missed.">		return type == ValueType.doubleValue || type == ValueType.longValue;</span>
	}

	public boolean isDouble () {
<span class="nc bnc" id="L816" title="All 2 branches missed.">		return type == ValueType.doubleValue;</span>
	}

	public boolean isLong () {
<span class="nc bnc" id="L820" title="All 2 branches missed.">		return type == ValueType.longValue;</span>
	}

	public boolean isBoolean () {
<span class="nc bnc" id="L824" title="All 2 branches missed.">		return type == ValueType.booleanValue;</span>
	}

	public boolean isNull () {
<span class="nc bnc" id="L828" title="All 2 branches missed.">		return type == ValueType.nullValue;</span>
	}

	/** Returns true if this is not an array or object. */
	public boolean isValue () {
<span class="nc bnc" id="L833" title="All 2 branches missed.">		switch (type) {</span>
		case stringValue:
		case doubleValue:
		case longValue:
		case booleanValue:
		case nullValue:
<span class="nc" id="L839">			return true;</span>
		}
<span class="nc" id="L841">		return false;</span>
	}

	/** Returns the name for this object value.
	 * @return May be null. */
	public String name () {
<span class="nc" id="L847">		return name;</span>
	}

	public void setName (String name) {
<span class="nc" id="L851">		this.name = name;</span>
<span class="nc" id="L852">	}</span>

	/** Returns the parent for this value.
	 * @return May be null. */
	public JsonValue parent () {
<span class="nc" id="L857">		return parent;</span>
	}

	/** Returns the first child for this object or array.
	 * @return May be null. */
	public JsonValue child () {
<span class="nc" id="L863">		return child;</span>
	}

	/** Returns the next sibling of this value.
	 * @return May be null. */
	public JsonValue next () {
<span class="nc" id="L869">		return next;</span>
	}

	public void setNext (JsonValue next) {
<span class="nc" id="L873">		this.next = next;</span>
<span class="nc" id="L874">	}</span>

	/** Returns the previous sibling of this value.
	 * @return May be null. */
	public JsonValue prev () {
<span class="nc" id="L879">		return prev;</span>
	}

	public void setPrev (JsonValue prev) {
<span class="nc" id="L883">		this.prev = prev;</span>
<span class="nc" id="L884">	}</span>

	/** @param value May be null. */
	public void set (String value) {
<span class="nc" id="L888">		stringValue = value;</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">		type = value == null ? ValueType.nullValue : ValueType.stringValue;</span>
<span class="nc" id="L890">	}</span>

	/** @param stringValue May be null if the string representation is the string value of the double (eg, no leading zeros). */
	public void set (double value, String stringValue) {
<span class="nc" id="L894">		doubleValue = value;</span>
<span class="nc" id="L895">		longValue = (long)value;</span>
<span class="nc" id="L896">		this.stringValue = stringValue;</span>
<span class="nc" id="L897">		type = ValueType.doubleValue;</span>
<span class="nc" id="L898">	}</span>

	/** @param stringValue May be null if the string representation is the string value of the long (eg, no leading zeros). */
	public void set (long value, String stringValue) {
<span class="nc" id="L902">		longValue = value;</span>
<span class="nc" id="L903">		doubleValue = (double)value;</span>
<span class="nc" id="L904">		this.stringValue = stringValue;</span>
<span class="nc" id="L905">		type = ValueType.longValue;</span>
<span class="nc" id="L906">	}</span>

	public void set (boolean value) {
<span class="nc bnc" id="L909" title="All 2 branches missed.">		longValue = value ? 1 : 0;</span>
<span class="nc" id="L910">		type = ValueType.booleanValue;</span>
<span class="nc" id="L911">	}</span>

	public String toJson (OutputType outputType) {
<span class="nc bnc" id="L914" title="All 2 branches missed.">		if (isValue()) return asString();</span>
<span class="nc" id="L915">		StringBuilder buffer = new StringBuilder(512);</span>
<span class="nc" id="L916">		json(this, buffer, outputType);</span>
<span class="nc" id="L917">		return buffer.toString();</span>
	}

	private void json (JsonValue object, StringBuilder buffer, OutputType outputType) {
<span class="nc bnc" id="L921" title="All 2 branches missed.">		if (object.isObject()) {</span>
<span class="nc bnc" id="L922" title="All 2 branches missed.">			if (object.child == null)</span>
<span class="nc" id="L923">				buffer.append(&quot;{}&quot;);</span>
			else {
<span class="nc" id="L925">				int start = buffer.length();</span>
				while (true) {
<span class="nc" id="L927">					buffer.append('{');</span>
<span class="nc" id="L928">					int i = 0;</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">					for (JsonValue child = object.child; child != null; child = child.next) {</span>
<span class="nc" id="L930">						buffer.append(outputType.quoteName(child.name));</span>
<span class="nc" id="L931">						buffer.append(':');</span>
<span class="nc" id="L932">						json(child, buffer, outputType);</span>
<span class="nc bnc" id="L933" title="All 2 branches missed.">						if (child.next != null) buffer.append(',');</span>
					}
<span class="nc" id="L935">					break;</span>
				}
<span class="nc" id="L937">				buffer.append('}');</span>
<span class="nc" id="L938">			}</span>
<span class="nc bnc" id="L939" title="All 2 branches missed.">		} else if (object.isArray()) {</span>
<span class="nc bnc" id="L940" title="All 2 branches missed.">			if (object.child == null)</span>
<span class="nc" id="L941">				buffer.append(&quot;[]&quot;);</span>
			else {
<span class="nc" id="L943">				int start = buffer.length();</span>
				while (true) {
<span class="nc" id="L945">					buffer.append('[');</span>
<span class="nc bnc" id="L946" title="All 2 branches missed.">					for (JsonValue child = object.child; child != null; child = child.next) {</span>
<span class="nc" id="L947">						json(child, buffer, outputType);</span>
<span class="nc bnc" id="L948" title="All 2 branches missed.">						if (child.next != null) buffer.append(',');</span>
					}
					break;
				}
<span class="nc" id="L952">				buffer.append(']');</span>
<span class="nc" id="L953">			}</span>
<span class="nc bnc" id="L954" title="All 2 branches missed.">		} else if (object.isString()) {</span>
<span class="nc" id="L955">			buffer.append(outputType.quoteValue(object.asString()));</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">		} else if (object.isDouble()) {</span>
<span class="nc" id="L957">			double doubleValue = object.asDouble();</span>
<span class="nc" id="L958">			long longValue = object.asLong();</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">			buffer.append(doubleValue == longValue ? longValue : doubleValue);</span>
<span class="nc bnc" id="L960" title="All 2 branches missed.">		} else if (object.isLong()) {</span>
<span class="nc" id="L961">			buffer.append(object.asLong());</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">		} else if (object.isBoolean()) {</span>
<span class="nc" id="L963">			buffer.append(object.asBoolean());</span>
<span class="nc bnc" id="L964" title="All 2 branches missed.">		} else if (object.isNull()) {</span>
<span class="nc" id="L965">			buffer.append(&quot;null&quot;);</span>
		} else
<span class="nc" id="L967">			throw new SerializationException(&quot;Unknown object type: &quot; + object);</span>
<span class="nc" id="L968">	}</span>

	public String toString () {
<span class="nc bnc" id="L971" title="All 4 branches missed.">		if (isValue()) return name == null ? asString() : name + &quot;: &quot; + asString();</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">		return (name == null ? &quot;&quot; : name + &quot;: &quot;) + prettyPrint(OutputType.minimal, 0);</span>
	}

	public String prettyPrint (OutputType outputType, int singleLineColumns) {
<span class="nc" id="L976">		PrettyPrintSettings settings = new PrettyPrintSettings();</span>
<span class="nc" id="L977">		settings.outputType = outputType;</span>
<span class="nc" id="L978">		settings.singleLineColumns = singleLineColumns;</span>
<span class="nc" id="L979">		return prettyPrint(settings);</span>
	}

	public String prettyPrint (PrettyPrintSettings settings) {
<span class="nc" id="L983">		StringBuilder buffer = new StringBuilder(512);</span>
<span class="nc" id="L984">		prettyPrint(this, buffer, 0, settings);</span>
<span class="nc" id="L985">		return buffer.toString();</span>
	}

	private void prettyPrint (JsonValue object, StringBuilder buffer, int indent, PrettyPrintSettings settings) {
<span class="nc" id="L989">		OutputType outputType = settings.outputType;</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">		if (object.isObject()) {</span>
<span class="nc bnc" id="L991" title="All 2 branches missed.">			if (object.child == null)</span>
<span class="nc" id="L992">				buffer.append(&quot;{}&quot;);</span>
			else {
<span class="nc bnc" id="L994" title="All 2 branches missed.">				boolean newLines = !isFlat(object);</span>
<span class="nc" id="L995">				int start = buffer.length();</span>
				outer:
				while (true) {
<span class="nc bnc" id="L998" title="All 2 branches missed.">					buffer.append(newLines ? &quot;{\n&quot; : &quot;{ &quot;);</span>
<span class="nc" id="L999">					int i = 0;</span>
<span class="nc bnc" id="L1000" title="All 2 branches missed.">					for (JsonValue child = object.child; child != null; child = child.next) {</span>
<span class="nc bnc" id="L1001" title="All 2 branches missed.">						if (newLines) indent(indent, buffer);</span>
<span class="nc" id="L1002">						buffer.append(outputType.quoteName(child.name));</span>
<span class="nc" id="L1003">						buffer.append(&quot;: &quot;);</span>
<span class="nc" id="L1004">						prettyPrint(child, buffer, indent + 1, settings);</span>
<span class="nc bnc" id="L1005" title="All 6 branches missed.">						if ((!newLines || outputType != OutputType.minimal) &amp;&amp; child.next != null) buffer.append(',');</span>
<span class="nc bnc" id="L1006" title="All 2 branches missed.">						buffer.append(newLines ? '\n' : ' ');</span>
<span class="nc bnc" id="L1007" title="All 4 branches missed.">						if (!newLines &amp;&amp; buffer.length() - start &gt; settings.singleLineColumns) {</span>
<span class="nc" id="L1008">							buffer.setLength(start);</span>
<span class="nc" id="L1009">							newLines = true;</span>
<span class="nc" id="L1010">							continue outer;</span>
						}
					}
<span class="nc" id="L1013">					break;</span>
				}
<span class="nc bnc" id="L1015" title="All 2 branches missed.">				if (newLines) indent(indent - 1, buffer);</span>
<span class="nc" id="L1016">				buffer.append('}');</span>
<span class="nc" id="L1017">			}</span>
<span class="nc bnc" id="L1018" title="All 2 branches missed.">		} else if (object.isArray()) {</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">			if (object.child == null)</span>
<span class="nc" id="L1020">				buffer.append(&quot;[]&quot;);</span>
			else {
<span class="nc bnc" id="L1022" title="All 2 branches missed.">				boolean newLines = !isFlat(object);</span>
<span class="nc bnc" id="L1023" title="All 4 branches missed.">				boolean wrap = settings.wrapNumericArrays || !isNumeric(object);</span>
<span class="nc" id="L1024">				int start = buffer.length();</span>
				outer:
				while (true) {
<span class="nc bnc" id="L1027" title="All 2 branches missed.">					buffer.append(newLines ? &quot;[\n&quot; : &quot;[ &quot;);</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">					for (JsonValue child = object.child; child != null; child = child.next) {</span>
<span class="nc bnc" id="L1029" title="All 2 branches missed.">						if (newLines) indent(indent, buffer);</span>
<span class="nc" id="L1030">						prettyPrint(child, buffer, indent + 1, settings);</span>
<span class="nc bnc" id="L1031" title="All 6 branches missed.">						if ((!newLines || outputType != OutputType.minimal) &amp;&amp; child.next != null) buffer.append(',');</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">						buffer.append(newLines ? '\n' : ' ');</span>
<span class="nc bnc" id="L1033" title="All 6 branches missed.">						if (wrap &amp;&amp; !newLines &amp;&amp; buffer.length() - start &gt; settings.singleLineColumns) {</span>
<span class="nc" id="L1034">							buffer.setLength(start);</span>
<span class="nc" id="L1035">							newLines = true;</span>
<span class="nc" id="L1036">							continue outer;</span>
						}
					}
<span class="nc" id="L1039">					break;</span>
				}
<span class="nc bnc" id="L1041" title="All 2 branches missed.">				if (newLines) indent(indent - 1, buffer);</span>
<span class="nc" id="L1042">				buffer.append(']');</span>
<span class="nc" id="L1043">			}</span>
<span class="nc bnc" id="L1044" title="All 2 branches missed.">		} else if (object.isString()) {</span>
<span class="nc" id="L1045">			buffer.append(outputType.quoteValue(object.asString()));</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">		} else if (object.isDouble()) {</span>
<span class="nc" id="L1047">			double doubleValue = object.asDouble();</span>
<span class="nc" id="L1048">			long longValue = object.asLong();</span>
<span class="nc bnc" id="L1049" title="All 2 branches missed.">			buffer.append(doubleValue == longValue ? longValue : doubleValue);</span>
<span class="nc bnc" id="L1050" title="All 2 branches missed.">		} else if (object.isLong()) {</span>
<span class="nc" id="L1051">			buffer.append(object.asLong());</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">		} else if (object.isBoolean()) {</span>
<span class="nc" id="L1053">			buffer.append(object.asBoolean());</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">		} else if (object.isNull()) {</span>
<span class="nc" id="L1055">			buffer.append(&quot;null&quot;);</span>
		} else
<span class="nc" id="L1057">			throw new SerializationException(&quot;Unknown object type: &quot; + object);</span>
<span class="nc" id="L1058">	}</span>

	static private boolean isFlat (JsonValue object) {
<span class="nc bnc" id="L1061" title="All 2 branches missed.">		for (JsonValue child = object.child; child != null; child = child.next)</span>
<span class="nc bnc" id="L1062" title="All 4 branches missed.">			if (child.isObject() || child.isArray()) return false;</span>
<span class="nc" id="L1063">		return true;</span>
	}

	static private boolean isNumeric (JsonValue object) {
<span class="nc bnc" id="L1067" title="All 2 branches missed.">		for (JsonValue child = object.child; child != null; child = child.next)</span>
<span class="nc bnc" id="L1068" title="All 2 branches missed.">			if (!child.isNumber()) return false;</span>
<span class="nc" id="L1069">		return true;</span>
	}

	static private void indent (int count, StringBuilder buffer) {
<span class="nc bnc" id="L1073" title="All 2 branches missed.">		for (int i = 0; i &lt; count; i++)</span>
<span class="nc" id="L1074">			buffer.append('\t');</span>
<span class="nc" id="L1075">	}</span>

<span class="nc" id="L1077">	public enum ValueType {</span>
<span class="nc" id="L1078">		object, array, stringValue, doubleValue, longValue, booleanValue, nullValue</span>
	}

	public JsonIterator iterator () {
<span class="nc" id="L1082">		return new JsonIterator();</span>
	}

<span class="nc" id="L1085">	public class JsonIterator implements Iterator&lt;JsonValue&gt;, Iterable&lt;JsonValue&gt; {</span>
<span class="nc" id="L1086">		JsonValue entry = child;</span>
		JsonValue current;

		public boolean hasNext () {
<span class="nc bnc" id="L1090" title="All 2 branches missed.">			return entry != null;</span>
		}

		public JsonValue next () {
<span class="nc" id="L1094">			current = entry;</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">			if (current == null) throw new NoSuchElementException();</span>
<span class="nc" id="L1096">			entry = current.next;</span>
<span class="nc" id="L1097">			return current;</span>
		}

		public void remove () {
<span class="nc bnc" id="L1101" title="All 2 branches missed.">			if (current.prev == null) {</span>
<span class="nc" id="L1102">				child = current.next;</span>
<span class="nc bnc" id="L1103" title="All 2 branches missed.">				if (child != null) child.prev = null;</span>
			} else {
<span class="nc" id="L1105">				current.prev.next = current.next;</span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">				if (current.next != null) current.next.prev = current.prev;</span>
			}
<span class="nc" id="L1108">			size--;</span>
<span class="nc" id="L1109">		}</span>

		public Iterator&lt;JsonValue&gt; iterator () {
<span class="nc" id="L1112">			return this;</span>
		}
	}

	/** Returns a human readable string representing the path from the root of the JSON object graph to this value. */
	public String trace () {
<span class="nc bnc" id="L1118" title="All 2 branches missed.">		if (parent == null) {</span>
<span class="nc bnc" id="L1119" title="All 2 branches missed.">			if (type == ValueType.array) return &quot;[]&quot;;</span>
<span class="nc bnc" id="L1120" title="All 2 branches missed.">			if (type == ValueType.object) return &quot;{}&quot;;</span>
<span class="nc" id="L1121">			return &quot;&quot;;</span>
		}
		String trace;
<span class="nc bnc" id="L1124" title="All 2 branches missed.">		if (parent.type == ValueType.array) {</span>
<span class="nc" id="L1125">			trace = &quot;[]&quot;;</span>
<span class="nc" id="L1126">			int i = 0;</span>
<span class="nc bnc" id="L1127" title="All 2 branches missed.">			for (JsonValue child = parent.child; child != null; child = child.next, i++) {</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">				if (child == this) {</span>
<span class="nc" id="L1129">					trace = &quot;[&quot; + i + &quot;]&quot;;</span>
<span class="nc" id="L1130">					break;</span>
				}
			}
<span class="nc bnc" id="L1133" title="All 2 branches missed.">		} else if (name.indexOf('.') != -1)</span>
<span class="nc" id="L1134">			trace = &quot;.\&quot;&quot; + name.replace(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;) + &quot;\&quot;&quot;;</span>
		else
<span class="nc" id="L1136">			trace = '.' + name;</span>
<span class="nc" id="L1137">		return parent.trace() + trace;</span>
	}

<span class="nc" id="L1140">	static public class PrettyPrintSettings {</span>
		public OutputType outputType;

		/** If an object on a single line fits this many columns, it won't wrap. */
		public int singleLineColumns;

		/** Arrays of floats won't wrap. */
		public boolean wrapNumericArrays;
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.5.5.201112152213</span></div></body></html>